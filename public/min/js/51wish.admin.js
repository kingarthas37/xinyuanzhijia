require=function e(n,t,o){function r(i,c){if(!t[i]){if(!n[i]){var u="function"==typeof require&&require;if(!c&&u)return u(i,!0);if(a)return a(i,!0);var l=new Error("Cannot find module '"+i+"'");throw l.code="MODULE_NOT_FOUND",l}var s=t[i]={exports:{}};n[i][0].call(s.exports,function(e){var t=n[i][1][e];return r(t?t:e)},s,s.exports,e,n,t,o)}return t[i].exports}for(var a="function"==typeof require&&require,i=0;i<o.length;i++)r(o[i]);return r}({5:[function(e,n,t){"use strict";e("../../../../js/main"),e("./config"),e("./common")},{"../../../../js/main":18,"./common":3,"./config":4}],4:[function(e,n,t){"use strict";var o="51wish";window.env=function(){return location.hostname===o+".leanapp.cn"||location.hostname===o+".cn"||location.host==="www."+o+".cn"?"production":location.hostname==="stg-"+o+".leanapp.cn"?"stage":"development"};var r=function(){return"production"===env()?"//51wish.cn/1.1/functions/":"stage"===env()?"//stg-51wish.leanapp.cn/1.1/functions/":"/1.1/functions/"};window.leanApp={appdId:"QuiPuWpJPzCahsgBK7teBOJN-gzGzoHsz",api:"https://leancloud.cn/1.1/",cloud:r()},window.leanAppHeader={"x-lc-id":leanApp.appdId,"x-lc-sign":$.cookie("x_lc_sign")||"","x-lc-session":$.cookie("x_lc_session")||"","x-lc-prod":"production"===env()?1:0,"content-type":"application/json"}},{}],3:[function(e,n,t){"use strict";var o=e("amazeui");$(function(){for(var e,n=function(){},t=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],r=t.length,a=window.console=window.console||{};r--;)e=t[r],a[e]||(a[e]=n);$.extend($.validator.messages,{required:"必选字段",remote:"请修正该字段",email:"请输入正确格式的电子邮件",url:"请输入合法的网址",date:"请输入合法的日期",dateISO:"请输入合法的日期 (ISO).",number:"请输入合法的数字",digits:"只能输入整数",creditcard:"请输入合法的信用卡号",equalTo:"请再次输入相同的值",accept:"请输入拥有合法后缀名的字符串",maxlength:jQuery.validator.format("请输入一个 长度最多是 {0} 的字符串"),minlength:jQuery.validator.format("请输入一个 长度最少是 {0} 的字符串"),rangelength:jQuery.validator.format("请输入 一个长度介于 {0} 和 {1} 之间的字符串"),range:jQuery.validator.format("请输入一个介于 {0} 和 {1} 之间的值"),max:jQuery.validator.format("请输入一个最大为{0} 的值"),min:jQuery.validator.format("请输入一个最小为{0} 的值")}),o.plugin("amuiSelected",o.selected),$("[data-am-selected]").amuiSelected(),$(".am-alert.am-alert-success").length&&setTimeout(function(){$(".am-alert.am-alert-success").hide()},3e3),$(".btn-back").click(function(){history.back(-1)})})},{amazeui:9}]},{},[5]);
require=function t(e,a,n){function o(i,c){if(!a[i]){if(!e[i]){var s="function"==typeof require&&require;if(!c&&s)return s(i,!0);if(r)return r(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=a[i]={exports:{}};e[i][0].call(u.exports,function(t){var a=e[i][1][t];return o(a?a:t)},u,u.exports,t,e,a,n)}return a[i].exports}for(var r="function"==typeof require&&require,i=0;i<n.length;i++)o(n[i]);return o}({7:[function(t,e,a){"use strict";t("../../../../js/main"),t("./product"),t("./product-category"),t("./product-method"),t("./product-preview"),t("./product-property"),t("./product-brand"),t("./product-groups"),t("./product-groups-name"),t("./upload"),t("./sign"),t("./import-order"),t("./article-category"),t("./spent"),t("./order"),t("./customer"),t("./identity"),t("./ship-order"),t("./purchase"),t("./purchase-contact")},{"../../../../js/main":18,"./article-category":"article-category","./customer":"customer","./identity":"identity","./import-order":"import-order","./order":"order","./product":"product","./product-brand":"product-brand","./product-category":"product-category","./product-groups":"product-groups","./product-groups-name":"product-groups-name","./product-method":"product-method","./product-preview":"product-preview","./product-property":"product-property","./purchase":"purchase","./purchase-contact":"purchase-contact","./ship-order":"ship-order","./sign":"sign","./spent":"spent","./upload":"upload"}],upload:[function(t,e,a){"use strict";e.exports={uploadFile:function(t){var e=$("#form-upload"),a=$("#file"),n=$(".upload-loading"),o=$(".am-btn"),r=$(".text"),i=t.fileType,c=t.callbackName;e.submit(function(){return n.addClass("on"),o.removeClass("am-btn-primary").addClass("am-btn-default").prop("disabled",!0),r.text("正在上传..."),a.hide(),$(this).ajaxSubmit({data:{fileType:i},success:function(t){a.val(""),n.removeClass("on"),o.addClass("am-btn-primary").removeClass("am-btn-default").prop("disabled",!1),r.text("选择要上传的文件"),a.show(),t.success?window.parent[c](t.data):alert(t.error)}}),!1}),a.change(function(){this.value&&e.submit()})}}},{}],spent:[function(t,e,a){"use strict";t("jquery-validate"),e.exports={indexFun:function(){var t=0;$(".cell-user1").each(function(e,a){t+=Number($(a).text())});var e=0;$(".cell-user2").each(function(t,a){e+=Number($(a).text())});var a=0;$(".cell-user3").each(function(t,e){a+=Number($(e).text())});var n=0;$(".cell-user4").each(function(t,e){n+=Number($(e).text())}),$("#total-user1").text(t.toFixed(2)),$("#total-user2").text(e.toFixed(2)),$("#total-user3").text(a.toFixed(2)),$("#total-user4").text(n.toFixed(2)),$("#total-spent").text((t-e-a-n).toFixed(2))},editFun:function(){$("#form-edit-earning").validate(),$("#spent-user1-comment,#spent-user2-comment,#spent-user3-comment,#spent-user4-comment").change(function(){var t=0,e=$(this).parent().prev().prev().find("input[type=text]"),a=this.value.match(/\\([^\n]+)/g);if(!a)return void e.val(0);for(var n=0;n<a.length;n++)a[n]=a[n].replace("\\",""),a[n]=$.trim(a[n]),t+=Number(a[n]);e.val(t.toFixed(2))})}}},{"jquery-validate":17}],sign:[function(t,e,a){"use strict";t("jquery-validate"),e.exports={loginFun:function(){this.submitControl()},registerFun:function(){this.submitControl()},submitControl:function(){var t=$("#submit");$(".am-form").validator({submit:function(){return this.isFormValid()?void t.attr("disabled",!0).addClass("am-disabled"):!1}})}}},{"jquery-validate":17}],"ship-order":[function(t,e,a){"use strict";t("jquery-validate"),t("jquery-form");t("async");e.exports={indexFun:function(){function t(t){return/^8235/.test(t)||/^YT/.test(t)?"YTO":/^73/.test(t)?"ZTO":/^56/.test(t)?"HTKY":/^52/.test(t)?"HTKY":/^221/.test(t)?"STO":/^SF/.test(t)?"SFEXPRESS":"ems"}var e=$("#modal-copy"),a=$("#modal-loading"),n=$(".select-order-copy-count"),o=$(".ckb-order-child");$(".copy-ship-order").click(function(){var t=$(this).data("id"),r=$(this).parents("tr").attr("data-id");e.modal({relatedTarget:this,onConfirm:function(e){function i(){if(c===s)return a.modal("close"),location.reload(),!1;c++;var e={countName:10>c?"0"+c:c,isChildOrder:o.prop("checked"),parentDataId:r};$.ajax({url:"/order/ship-order/copy/"+t,data:e,method:"post",success:function(t){i()}})}var c=0,s=parseInt(n.val());a.modal(),i()}})}),$(".remove-ship-order").click(function(){if(confirm("确认删除？")){var t=$(this).data("id");$.ajax({url:"/order/ship-order/remove/"+t,method:"post",success:function(t){location.reload()}})}}),$(".ckb-is-haiguan").click(function(){var t=$(this).parents("tr"),e=$(this).data("id"),a="isHaiguan",n=this.checked?"true":"false";$.ajax({url:"/order/ship-order/updateOrderStatus/"+e+"/"+a+"/"+n,method:"post"}).done(function(){if("true"===n&&t.hasClass("child")){var e=$(".am-table").find("tr[data-id="+t.attr("parent-data-id")+"]");e.find(".ckb-is-haiguan").prop("checked")||e.find(".ckb-is-haiguan").click()}})}),$(".ckb-is-arrived").click(function(){var t=$(this).parents("tr").find(".ckb-is-haiguan");t[0].checked||t.click();var e=$(this).data("id"),a="isArrived",n=this.checked?"true":"false";$.ajax({url:"/order/ship-order/updateOrderStatus/"+e+"/"+a+"/"+n,method:"post",success:function(t){t.success&&("true"===n?alert("已确认签收!"):alert("取消签收"))}})});var r=$(".am-table");$.cookie("hide-arrived-order")&&($(".hide-arrived-order").prop("checked",!0),r.find("tbody tr").each(function(t,e){$(e).find(".ckb-is-arrived")[0].checked&&$(e).addClass("hide")})),$(".hide-arrived-order").click(function(){this.checked?($.cookie("hide-arrived-order","true",{expires:new Date((new Date).getTime()+31536e6),path:"/",domain:location.host}),r.find("tbody tr").each(function(t,e){$(e).find(".ckb-is-arrived")[0].checked&&$(e).addClass("hide")})):($.cookie("hide-arrived-order","",{expires:new Date((new Date).getTime()),path:"/",domain:location.host}),r.find("tr.hide").removeClass("hide"))}),$(".clipboard-order").each(function(t,e){var a=this,n=new Clipboard(this);n.on("success",function(){$(a).addClass("active")})}),$(".clipboard-tracking").each(function(t,e){var a=this,n=new Clipboard(this);n.on("success",function(){$(a).addClass("active")})});var i=$("#modal-edit-tracking"),c=$("#input-edit-tracking");$(".edit-tracking").each(function(t,e){$(this).click(function(){setTimeout(function(){c.val(""),c[0].focus()},100),i.modal({relatedTarget:this,onConfirm:function(t){var e=$(this.relatedTarget).data("id"),a=$(this.relatedTarget).parents("tr"),n=a.find(".search-tracking");$.ajax({url:"/order/ship-order/edit-tracking/"+e,type:"post",data:{value:$.trim(c.val())},success:function(t){n.attr("data-tracking",$.trim(c.val())),n.text($.trim(c.val())),a.find(".ckb-is-haiguan")[0].checked||a.find(".ckb-is-haiguan").click()}})}})})});var s=$("#modal-edit-remark"),d=$("#input-edit-remark");$(".edit-remark").click(function(){var t=$(this).parents("tr");setTimeout(function(){d.val($.trim(t.find(".remark").text())),d[0].focus()},100),s.modal({relatedTarget:this,onConfirm:function(t){var e=$(this.relatedTarget).parents("tr"),a=$(this.relatedTarget).attr("data-id"),n=e.find(".remark");$.ajax({url:"/order/ship-order/edit-remark/"+a,type:"post",data:{value:$.trim(d.val())},success:function(t){n.attr("data-remark",$.trim(d.val())),n.text($.trim(d.val()))}})}})});var u=$("#modal-edit-ship-order"),l=$("#input-edit-ship-order");$(".edit-ship-order").click(function(){var t=$(this).parents("tr");setTimeout(function(){l.val($.trim(t.find(".ship-order-number").text())),l[0].focus()},100),u.modal({relatedTarget:this,onConfirm:function(t){var e=$(this.relatedTarget).parents("tr"),a=$(this.relatedTarget).attr("data-id"),n=e.find(".ship-order-number");$.ajax({url:"/order/ship-order/edit-ship-order-number/"+a,type:"post",data:{value:$.trim(l.val())},success:function(t){n.text($.trim(l.val()))}})}})});var p=$("#modal-loading"),m=$("#modal-tracking-info");$(".am-table").on("click",".search-tracking",function(){var e=$(this).text();$(this).addClass("active"),p.modal();var a=t(e);$.ajax({url:"/order/ship-order/express/"+e+"/"+a,type:"get",success:function(t){if(p.modal("close"),!t.list)return m.find(".am-modal-bd").html("<p>"+t.msg+"</p>"),m.modal(),!1;var e="";$.each(t.list,function(t,a){e+="<p><strong>"+a.time+"</strong> "+a.status+"</p>"}),m.find(".am-modal-bd").html(e),m.modal()}})});var h=$(".am-table");$(".search-child-tracking").click(function(){var e=$(this).parents("tr"),a=e.attr("data-id");e.find(".open-child-order i").hasClass("am-icon-plus-square-o")&&!e.find(".ckb-is-arrived").prop("checked")&&e.find(".open-child-order").click(),h.find("tr[parent-data-id="+a+"]").each(function(e,a){if($(a).find(".show-name.on").length)return void $(this).find(".show-name").click().removeClass("on");if(!$(a).find(".ckb-is-arrived").prop("checked")&&$(a).find(".search-tracking").text().length){var n=$(a).find(".search-tracking").text(),o=$(a).find(".show-name"),r=t(n);$.ajax({url:"/order/ship-order/express/"+n+"/"+r,type:"get",success:function(t){t.list?o.popover({content:"<p><strong>"+t.list[0].time+"</strong> "+t.list[0].status+"</p>"}):o.popover({content:"无查询信息"}),o.addClass("on").click()}})}})}),$(".search-all-tracking").click(function(){$(".search-tracking").each(function(e,a){var n=$(a).parents("tr");if(!n.hasClass("hide")&&$(a).attr("data-tracking")){var o=$(a).attr("data-tracking"),r=t(o);$.ajax({url:"/order/ship-order/express/"+o+"/"+r,type:"get",success:function(t){return t.list?void $(a).addClass("has-tracking"):($(a).addClass("no-tracking"),!1)}})}})}),$(".open-child-order").click(function(){var t=$(this).parents("tr"),e=t.data("id"),a=$(".am-table");$(this).find("i").hasClass("am-icon-plus-square-o")?($(this).find("i").removeClass("am-icon-plus-square-o").addClass("am-icon-minus-square-o"),t.data("is-expand")?a.find("tr[parent-data-id="+e+"]").addClass("on"):(a.find("tr[parent-data-id="+e+"]").each(function(e,a){$(this).addClass("on"),t.after(a)}),t.data("is-expand",!0))):($(this).find("i").removeClass("am-icon-minus-square-o").addClass("am-icon-plus-square-o"),a.find("tr[parent-data-id="+e+"]").removeClass("on"),a.find("tr[parent-data-id="+e+"]").find(".show-name.on").click())});var f=$(".copy-yuntao-code"),v=new Clipboard(f[0],{text:function(){return"\n                        var arr = [];\n                        arr.push($.trim($('.text-left').eq(0).text()));\n                        arr.push(location.href);\n                        arr.push($.trim($('.col-sm-9.text-left').eq(7).text()));\n                        arr.push(/单号为([a-zA-Z0-9]+)/.exec($('.table').eq(3).find('tr:last').text())[1]);\n                        arr.push($.trim($('.col-sm-9.text-left').eq(8).text()));\n                        arr.join();\n                    "}});v.on("success",function(){f.addClass("active")});var g=$(".am-table"),k=$("#modal-check-yuntao-code"),y=$(".input-check-yuntao-code"),b=$(".btn-check-yuntao-code"),x=$(".btn-go-yuntao-code");$(".check-yuntao-code").click(function(){k.modal(),y.val(""),setTimeout(function(){y[0].focus()},1)}),y.change(function(){var t=$.trim(y.val());y.val(t.replace('"',"").replace('"',""))}),b.click(function(){var t=y[0].value.split(","),e=t[0],a=$(".ship-order-number");a.each(function(t,n){if(t===a.length-1)return alert("匹配失败，无运淘订单记录!"),!1;if($(this).text()==e){var o=$(this).parents("tr"),r=o.attr("parent-data-id");o.addClass("bold");var i=y.val();return y.val(o.attr("data-ship-order-id")+","+i),g.find("tr[data-id="+r+"]").find(".open-child-order").find(".am-icon-plus-square-o").parent().click(),$("html,body").animate({scrollTop:o.offset().top-50}),!1}})}),x.click(function(){var t=y.val().split(","),e=g.find("tr[data-ship-order-id="+t[0]+"]"),a=t[4]+":"+t[5].substring(t[5].length-4);$.ajax({url:"/order/ship-order/go-yuntao-code",type:"post",data:{shipOrderId:t[0],link:t[2],name:t[3],trackingNumber:a},success:function(n){e.removeClass("bold"),e.find(".td-name").html('<span clas="show-name">'+t[3]+"</span>"),e.find(".td-link").html('<a href="'+t[2]+'" target="_blank">链接</a>'),e.find(".td-tracking-number").html('\n                            <a href="javascript:;" title="查询快递" class="search-tracking" data-tracking="'+t[4]+'">'+a+"</a>\n                         \n                        "),e.find(".ckb-is-haiguan").prop("checked")||e.find(".ckb-is-haiguan").click(),n.success?(alert("执行成功!"),k.modal("close")):alert("执行失败!")}})})},addFun:function(){$("#transferOrderNumber")[0].focus()}}},{async:1,"jquery-form":13,"jquery-validate":17}],"purchase-contact":[function(t,e,a){"use strict";t("jquery-validate"),t("jquery-form"),e.exports={indexFun:function(){$(".remove-purchase-contact").click(function(){var t=$(this);return $("#confirm-remove-purchase-contact").modal({relatedTarget:this,onConfirm:function(e){location.href=t.attr("href")},onCancel:function(){return!1}}),!1})},addFun:function(){$("#form-add-purchase-contact").validate()},editFun:function(){$("#form-edit-purchase-contact").validate()},uploadTitleImg:function(){var t=$("#form-upload-img"),e=$("#icon-image"),a=$(".upload-loading");t.submit(function(){return a.addClass("on"),$(this).ajaxSubmit({success:function(t){a.removeClass("on"),t.success?window.parent.uploadImgResponse(t.url):window.parent.uploadImgError(t.error)}}),!1}),e.change(function(){t.submit()})},uploadImgResponse:function(t){$("#image-url").val(t)},uploadImgError:function(t){var e=$("#alert-image-upload-error");e.find(".am-modal-bd").text(t),e.modal()}}},{"jquery-form":13,"jquery-validate":17}],purchase:[function(t,e,a){"use strict";t("jquery-validate");var n=t("bloodhound"),o=t("../common/utils");e.exports={indexFun:function(){$(".remove-purchase").click(function(){var t=$(this);return $("#confirm-remove-purchase").modal({relatedTarget:this,onConfirm:function(e){location.href=t.attr("href")},onCancel:function(){return!1}}),!1}),$(".ckb-shipping-status-shipped").click(function(){var t=this,e=$(this).parents("tr");$.ajax({url:"/order/purchase/shipping-status",type:"get",data:{purchaseId:$(this).attr("data-id"),status:this.checked?"shipped":"notshipped"}}).done(function(){t.checked?e.addClass("off-middle"):e.removeClass("off").removeClass("off-middle")})}),$(".ckb-shipping-status-forward").click(function(){var t=this,e=$(this).parents("tr");this.checked?e.find(".ckb-shipping-status-shipped").prop("checked",!0):(e.find(".ckb-shipping-status-shipped").prop("checked",!1),e.find(".ckb-shipping-status-arrived").prop("checked",!1)),$.ajax({url:"/order/purchase/shipping-status",type:"get",data:{purchaseId:$(this).attr("data-id"),status:this.checked?"forward":"notshipped"}}).done(function(){t.checked?e.addClass("off-middle"):e.removeClass("off").removeClass("off-middle")})}),$(".ckb-shipping-status-arrived").click(function(){var t=this,e=$(this).parents("tr");this.checked?(e.find(".ckb-shipping-status-shipped").prop("checked",!0),e.find(".ckb-shipping-status-forward").prop("checked",!0)):(e.find(".ckb-shipping-status-shipped").prop("checked",!1),e.find(".ckb-shipping-status-forward").prop("checked",!1)),$.ajax({url:"/order/purchase/shipping-status",type:"get",data:{purchaseId:$(this).attr("data-id"),status:this.checked?"arrived":"notshipped"}}).done(function(){t.checked?e.addClass("off"):e.removeClass("off").removeClass("off-middle")})}),$("#select-site-type").change(function(){return this.value?location.href="/order/purchase?site-type="+this.value:void(location.href="/order/purchase")}),$(".ckb-shipping-status").click(function(){this.checked?location.href="/order/purchase?shipping-status="+this.name+"&site-type="+$("#site-type").val():location.href="/order/purchase?site-type="+$("#site-type").val()}),$(".import-order").click(function(){$.ajax({url:"/order/purchase/import-order",type:"post",data:{purchaseId:$(this).data("purchase-id"),status:this.checked}}).done(function(){})});var t=$("#table"),e=$(".hide-wisdom-luckymojo-list");$.cookie("hide-wisdom-luckymojo-list")&&(e.prop("checked",!0),t.find("tbody tr").each(function(t,e){($(e).text().indexOf("luckymojo")>-1||$(e).text().indexOf("wisdom")>-1)&&$(e).addClass("hide")})),e.click(function(){this.checked?($.cookie("hide-wisdom-luckymojo-list","true",{expires:new Date((new Date).getTime()+31536e6),path:"/",domain:location.host}),t.find("tbody tr").each(function(t,e){($(e).text().indexOf("luckymojo")>-1||$(e).text().indexOf("wisdom")>-1)&&$(e).addClass("hide")})):($.cookie("hide-wisdom-luckymojo-list","",{expires:new Date((new Date).getTime()),path:"/",domain:location.host}),t.find("tbody tr").each(function(t,e){($(e).text().indexOf("luckymojo")>-1||$(e).text().indexOf("wisdom")>-1)&&$(e).removeClass("hide")}))})},addFun:function(){$("#form-add-purchase").validate(),this.purchaseTypeAhead()},editFun:function(){$("#form-add-purchase").validate(),this.purchaseTypeAhead(),this.purchaseProductTableList()},purchaseTypeAhead:function(){var t=$("#purchase-description"),e=$("#purchase-website"),a=$("#purchase-mail"),o=$("#purchase-image"),r=$(".purchase-image"),i=$("#purchase-comment"),c=function(){return/site-type=/.test(location.search)?/site-type=(.+)$/.exec(location.search)[1]:"normal"}();t.typeahead(null,{display:"value",highlight:!0,source:new n({datumTokenizer:n.tokenizers.obj.whitespace("value"),queryTokenizer:n.tokenizers.whitespace,remote:{url:"/order/purchase/add/website-desc",prepare:function(e,a){return a.data={name:t.val(),"site-type":c},a}}})}),t.on({"typeahead:select":function(t,n){console.info(n),e.val(n.website?n.website:n.shop),a.val(n.email),o.val(n.image),r.find("img").attr("src",n.image),i.val(n.comment)}})},purchaseProductTableList:function(){var t=$("#purchase-order-link"),e=$(".purchase-order-link-view"),a=$.trim($("#purchase-order-link").val()),n="",r="";return a?($.each(a.split("\n"),function(t,e){""!==$.trim(e)&&(e=e.replace(/\*\s/,"*"),e=e.replace(/(\S)\*/,"$1 *"),/\*\d*/.test(e)||(e+=" *1"),n+=e+(t===a.split("\n").length-1?"":"\n"))}),t.val(n),$.each(n.split("\n"),function(t,e){var a="-",n="-",i=function(){return/http[^\s]+/i.test(e)?/(http[^\s]+)/i.exec(e)[1]:/(.*)\*\d+/.exec(e)[1]}(),c=function(){return/\*\d+/.test(e)?/\*(\d+)/.exec(e)[1]:1}(),s=function(){return/\|\d+/.test(e)?"-"+/\|(\d+)/.exec(e)[1]:""}();/\.(jpg|jpeg|png|gif)/.test(i)?(a='<a href="'+i+'" target="_blank"><img src="'+i+'" /></a>',i='<span title="'+i+'"><a href="'+i+'" target="_blank">'+i+"</a></span>"):/^http/.test(i)?(o.getRemoteProductInfo(i,function(e,a){e.length&&($(".link-product-"+t).find(".img").html('<a href="'+e+'" target="_blank"><img src="'+e+'" /></a>'),$(".link-product-"+t).find(".title").text(""+a))}),i='<span title="'+i+'"><a href="'+i+'" target="_blank">'+i+"</a></span>"):i='<span title="'+i+'">'+i+"</span>";var d='\n                    <tr class="link-product-'+t+'">\n                        <td class="img t-c">'+a+'</td>     \n                        <td class="count t-c">'+c+' <span class="count-result">'+s+'</span></a></td>      \n                        <td class="count t-c">\n                            <a href="javascript:;" class="count-minus">预定+1</a>\n                            <span class="sp"></span>\n                            <a href="javascript:;" class="count-plus">取消-1</a>\n                        </td>      \n                        <td class="link">'+i+'</td>    \n                        <td class="title">'+n+"</td>      \n                    </tr>\n                ";r+=d}),e.find("tbody").append(r),e.find(".link a").click(function(){e.find(".on").removeClass("on"),$(this).parents("td").addClass("on")}),e.find(".count-minus").click(function(){var e=t.val(),a="",n=$(this).parents("tr"),o=n.find(".link span").attr("title"),r=n.find(".count-result"),i=e.split("\n");$.each(i,function(t,e){if(e.indexOf(o)>-1){var n=parseInt(/\*(\d+)/.exec(e)[1]),i=function(){return/\|\d+/.test(e)?parseInt(/\|(\d+)/.exec(e)[1]):0}();n>i&&(i++,r.text("-"+i)),e=/\|\d+/.test(e)?e.replace(/\|\d+/,"|"+i):e.replace(/(\*\d+)/,"$1 |"+i)}a+=e+"\n"}),t.val($.trim(a))}),void e.find(".count-plus").click(function(){var e=t.val(),a="",n=$(this).parents("tr"),o=n.find(".link span").attr("title"),r=n.find(".count-result"),i=e.split("\n");$.each(i,function(t,e){if(e.indexOf(o)>-1){var n=function(){return/\|\d+/.test(e)?parseInt(/\|(\d+)/.exec(e)[1]):0}();n>1?(n--,r.text("-"+n)):1===n&&(n--,r.text("")),e=/\|\d+/.test(e)?e.replace(/\|\d+/,"|"+n):e.replace(/(\*\d+)/,"$1 |"+n),e=e.replace(/\s\|0/,"")}a+=e+"\n"}),t.val($.trim(a))})):!1}}},{"../common/utils":6,bloodhound:10,"jquery-validate":17}],"product-property":[function(t,e,a){"use strict";var n=(window.leanAppHeader,t("bloodhound"));e.exports={init:function(){return location.search.indexOf("viewport=window")>-1&&!location.hash&&window.parent.closeViewportModal?void window.parent.closeViewportModal():(this.setContentDisplay(),this.setPurchaseLinkContent(),this.setShopLinkContent(),this.setStockContent(),this.setSettingsContent(),this.setContentManage(),this.setImageSourceLink(),void $(".save-norefresh").click(function(){window.parent.gReloadPageVar=!1}))},setContentDisplay:function(){if(location.hash){var t=$("#"+location.hash.substring(1));t.length&&(t.addClass("am-active"),t.find(".am-collapse").addClass("am-in"))}},setPurchaseLinkContent:function(){"#purchase-link"===location.hash&&setTimeout(function(){return $("input[name=purchase-link]").get(0).focus()},0)},setShopLinkContent:function(){"#shop-link"===location.hash&&setTimeout(function(){return $("input[name=shop-link]").get(0).focus()},0)},setStockContent:function(){var t=$("#stock"),e=t.find("input[name=stock]"),a=t.find("[name=sales]"),n=t.find(".stock-minus"),o=t.find(".stock-plus"),r=$(".stock-reset"),i=$("#sold"),c=$("#reserve"),s=t.find(".sold-plus"),d=t.find(".sold-minus");setTimeout(function(){e[0].focus(),e[0].select()},500),n.click(function(){var t=parseInt(e.val()),n=parseInt(a.val());t>0&&(e.val(t-1),a.val(n+1)),e.trigger("change")}),o.click(function(){var t=parseInt(e.val());e.val(t+1),e.trigger("change")}),r.click(function(){e.find("option[value="+e.data("stock")+"]")[0].selected=!0,a.val(a.data("sales")),c.val(c.data("reserve")),i.val(i.data("sold")),e.trigger("change")});var u=$(".ckb-warning-stock-out"),l=$(".ckb-warning-stock-in"),p=parseInt(e.val());u.click(function(){l.prop("checked",!1)}),l.click(function(){u.prop("checked",!1)}),p>0&&e.change(function(){0===parseInt(e.val())?u.prop("checked",!0):u.prop("checked",!1)}),0===p&&e.change(function(){parseInt(e.val())>0?(i.val(0),l.prop("checked",!0)):l.prop("checked",!1)}),s.click(function(){i.val(parseInt(i.val())+1)}),d.click(function(){parseInt(i.val())>0&&i.val(parseInt(i.val())-1)}),$(".reserve-plus").click(function(){var t=parseInt($(this).data("plus"));return 0===t||t>=parseInt(c.val())?void c.val(0):void c.val(parseInt(c.val())-t)})},setSettingsContent:function(){"#settings"===location.hash&&setTimeout(function(){return $("input[name=price]").get(0).focus()},0)},setContentManage:function(){var t=$("#brand-id"),e=$("[name=brand-id]");t.typeahead(null,{limit:10,display:function(t){return t.value},templates:{suggestion:function(t){return"<div>"+t.value+"</div>"}},highlight:!0,source:new n({datumTokenizer:n.tokenizers.obj.whitespace("value"),queryTokenizer:n.tokenizers.whitespace,remote:{url:"/admin/product-brand/ajax/search",prepare:function(e,a){return a.data={name:t.val()},a}}})}),t.on({"typeahead:select":function(t,a){var n=/\{id\:(\d+)\}/.exec(a.value)[1];e.val(n)}})},setImageSourceLink:function(){var t=$(".image-source-download"),e=$("textarea[name=image-source]").val().split("\n"),a=$("#product-id").val();e.length&&$.each(e,function(e,n){t.append('<a href="'+n+'" download="下载.'+a+"."+(e+1)+'">下载'+(e+1)+"</a> ")})}}},{bloodhound:10}],"product-preview":[function(t,e,a){"use strict";var n=t("../common/utils");e.exports={init:function(t){this.settings=t,this.updateDom(),this.waterMark(),this.screenShot(),this.screenShotRecommend()},btnCopy:function o(){var t=$(".preview-content"),e=$.trim(t.html()),o=$(".btn-copy"),a=new Clipboard(o[0],{text:function(){return e}});a.on("success",function(t){o.popover({content:"复制成功!"})})},updateDom:function(){$(".preview-content").find("em").each(function(){"date"===$.trim($(this).text())&&$(this).parents("li").detach()})},waterMark:function(){var t=$(".preview-content").find("div img");t.each(function(){var t=this.src;$(this).data("src-source",t.replace(/\?.+/,"")),$(this).data("src-target",t)}),$(".disable-watermark").click(function(){this.checked?t.each(function(){$(this).attr("src",$(this).data("src-source"))}):t.each(function(){$(this).attr("src",$(this).data("src-target"))})})},screenShot:function(){var t=$(".preview-content"),e="<style>\n            body { margin:0; width:750px; background: #fff;  font-family:'Segoe UI','Lucida Grande','Helvetica','Arial','Microsoft YaHei'; font-size: 22px; line-height: 32px; }\n            section { padding: 0; margin: 0 0 20px 0; }\n            section img { margin:0;}\n            div { padding: 0 15px; margin-bottom: 20px;}\n            ul {margin: 0 0 15px 0;padding: 0 0 0 20px;}\n            img { width: 100%; margin-bottom: 20px; }\n            p { margin: 0 0 15px 0; padding: 0;}\n        </style>",a=t.html(),n=$(".btn-shot");-1===location.href.indexOf("localhost")&&(n.hide(),$(".btn-shot-recommend").hide()),n.button("loading");var o=$.AMUI.progress;window.onload=function(){n.button("reset"),n.click(function(){o.start(),n.button("loading").text("图片生成中..."),$.ajax({url:"/admin/product/preview/shot",type:"post",data:{html:e+a,segmentHeight:600,htmlHeight:t.height(),name:"产品-"+$("h4").text().replace(/\//g,"")},success:function(){o.done(),$("#modal-shot-success").modal(),n.button("reset").text("生成淘宝详情图片")}})})}},recommendProducts:function(t,e){for(var a=this,o=[],r=0;r<t.length;r++)for(var i=0;i<t[r].products.length;i++)o.push(t[r].products[i]);$.ajax({type:"get",url:"/product/recommend/custom/"+o.join()}).then(function(o){for(var r=0;r<t.length;r++)for(var i=0;i<e.length;i++)t[r].productGroupId===e[i].productGroupId&&(t[r].name=e[i].productGroupName);for(var c=0;c<t.length;c++){t[c].html=[];for(var s=0;s<t[c].products.length;s++)for(var d=0;d<o.items.length;d++)o.items[d].productId===parseInt(t[c].products[s])&&t[c].html.push({productId:o.items[d].productId,name:o.items[d].name,image:n.productMainImageOutput(o.items[d].mainImage),price:o.items[d].price,isHot:o.items[d].isHot,shopLink:o.items[d].shopLink})}t=t.filter(function(t){return t.html.length}),a.recommendHtml(t)})},recommendHtml:function(t){var e=$(".recommend-content"),a="";$.each(t,function(t,e){a+='<h3 class="item">'+e.name+":</h3><div>",$.each(e.html,function(t,e){var n=e.shopLink[0]?'<a target="_blank" href="'+e.shopLink[0]+'">':"";a+='\n                    <dl class="item">\n                        '+n+'\n                        <dt><img src="'+e.image+'?imageMogr2/thumbnail/90"></dt>\n                        <dd>'+e.name+"</dd>\n                        "+(n?"</a>":"")+"\n                    </dl>\n                "}),a+="</div>"}),e.append(a);var n=0;e.find("img").each(function(t,a){var o=e.find("img").length;this.onload=function(){n++,n===o&&$(".btn-shot-recommend").button("reset")}})},screenShotRecommend:function(){var t=$(".btn-shot-recommend");if(t.length){var e="<style>\n            body { margin:0; width:750px; background: #fff;  font-family:'Segoe UI','Lucida Grande','Helvetica','Arial','Microsoft YaHei'; }  \n            h3 { height:100px; line-height: 100px; margin:0; font-size:24px; padding-left:15px; }\n            dl { margin:0; }\n            dl:before { content: ' ';display: table;}\n            dl:after { content: ' ';display: table; clear: both; }\n            dt { margin:0; float:left; text-align: center; width: 120px; height: 100px;}\n            dd { color:#666; float:left; margin:0; font-size:20px; width: 630px; height: 100px; line-height: 100px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }\n            dl img { margin-top:5px; width: 90px; height: 90px; border-radius: 5px; }\n            a dd { color:#333;  text-decoration: underline;}\n        </style>",a=$(".recommend-content");t.button("loading");var n=$.AMUI.progress;t.click(function(){n.start();var o=a.html();t.button("loading").text("图片生成中..."),$.ajax({url:"/admin/product/preview/shot",type:"post",data:{html:e+o,htmlHeight:100*(a.find("dl").length+a.find("h3").length),segmentHeight:100,name:"推荐-"+$("h4").text().replace(/\//g,"")},success:function(){n.done(),$("#modal-shot-success").modal(),t.button("reset").text("生成推荐产品图片")}})});var o=$(".recommend-code"),r=$(".btn-recommend-code-copy"),i=$(".recommend-code-hidden"),c="";$(".btn-recommend-code").click(function(){if(c="",i.html(o.val()),i.find("img").length!==a.find(".item").length)return alert("图片数量不一致,请重新输入!"),!1;for(var t=0;t<i.find("img").length;t++)if(-1===i.find("img").eq(t).attr("src").indexOf("alicdn"))return alert("图片地址有误,请重新输入!"),!1;$(this).removeClass("am-btn-primary").addClass("am-btn-success"),r.removeClass("am-btn-success").addClass("am-btn-primary"),c='<div><img src="https://img.alicdn.com/imgextra/i4/42879206/TB2Dw47p9BjpuFjSsplXXa5MVXa_!!42879206.png"></div>',a.find(".item").each(function(t,e){var a='<img src="'+i.find("img").eq(t).attr("src")+'"/>';c+=$(e).find("a").length?'<a href="'+$(e).find("a").attr("href")+'">'+a+"</a>":a}),i.html(c)});var s=new Clipboard(r[0],{text:function(){return c}});s.on("success",function(t){r.removeClass("am-btn-primary").addClass("am-btn-success")})}}}},{"../common/utils":6}],"product-method":[function(t,e,a){"use strict";window.leanAppHeader;e.exports={indexFun:function(){var t=$(".remove-product-method"),e=$("#confirm-remove-product-method"),a=$("#modal-alert");a.on("closed.modal.amui",function(){$(this).removeData("amui.modal")}),t.click(function(){e.modal({relatedTarget:this,onConfirm:function(){var t=$(this.relatedTarget),n=parseInt(t.data("id"));return t.data("state")?!1:(t.data("state",!0),$.AMUI.progress.start(),$.ajax({type:"post",url:"/admin/product-method/remove/"+n,success:function(n){t.data("state",!1),$.AMUI.progress.done(),e.modal("close"),n.success?a.modal({onConfirm:function(){return location.reload()}}).find(".am-modal-bd").text("删除产品类型成功!"):a.modal().find(".am-modal-bd").text(n.message)}}),!1)}})})},addFun:function(){this.submitControl()},editFun:function(){this.submitControl()},submitControl:function(){var t=$("#submit");$(".am-form").validator({submit:function(){return this.isFormValid()?void t.attr("disabled",!0).addClass("am-disabled"):!1}})}}},{}],"product-groups-name":[function(t,e,a){"use strict";window.leanAppHeader;e.exports={indexFun:function(){var t=$(".remove-product-group"),e=$("#confirm-remove-product-group"),a=$("#modal-alert");a.on("closed.modal.amui",function(){$(this).removeData("amui.modal")}),t.click(function(){e.modal({relatedTarget:this,onConfirm:function(){var t=$(this.relatedTarget),n=parseInt(t.data("id"));return t.data("state")?!1:(t.data("state",!0),$.AMUI.progress.start(),$.ajax({type:"post",url:"/admin/product-group/remove/"+n,success:function(n){t.data("state",!1),$.AMUI.progress.done(),e.modal("close"),n.success?a.modal({onConfirm:function(){return location.reload()}}).find(".am-modal-bd").text("删除产品组合类型成功!"):a.modal().find(".am-modal-bd").text(n.message)}}),!1)}})})},addFun:function(){this.submitControl()},editFun:function(){this.submitControl()},submitControl:function(){var t=$("#submit");$(".am-form").validator({submit:function(){return this.isFormValid()?void t.attr("disabled",!0).addClass("am-disabled"):!1}})}}},{}],"product-groups":[function(t,e,a){"use strict";var n=t("./product/autocomplete-product-name");t("../common/utils");e.exports={indexFun:function(){var t=$("#product-id").val(),e=$("#product-method-id").val(),a=$("#category1-id").val(),o=$("#category2-id").val(),r=$("#form-edit-groups"),i=$(".product-name");i.each(function(t,e){/\d+/.test(e.value)&&n.getId(e,e.value,function(){n.getName(e)})});var c='\n            <div class="am-form-group">\n                <div class="input">\n                    <input class="product-name" type="text" placeholder="输入产品名称(自动填充)" autocomplete="off">\n                </div>\n                <div class="del">\n                    <a href="javascript:;">- 删除</a>\n                </div>\n            </div>\n        ';
$(".product-group-add").click(function(){var t=$(this).parents(".product-group"),e=t.find(".list-group-field");e.append(c),n.getName(t.find(".product-name:last")),t.find(".product-name:last")[0].focus()}),r.on("click",".del a",function(){$(this).parent().parent().detach()}),$("#submit").click(function(){var n=$(this),r=[];return $(".product-group").each(function(t,e){r.push({}),r[t].productGroupId=$(e).data("group-id"),r[t].products=[];var a=$(e).find(".product-name").filter(function(){return!$(this).attr("readonly")});a.each(function(e,a){if(/\{id\:\d+\}/.test(a.value)){var n=/\{id\:(\d+)\}/.exec(a.value)[1];r[t].products.push(n)}})}),n.prop("disabled",!0),$.ajax({url:"/admin/product/groups/"+t,type:"post",data:{groups:JSON.stringify(r)}}).then(function(t){return t.success?location.href="/admin/product?product-method-id="+e+"&category1-id="+a+"&category2-id="+o:void n.prop("disabled",!1)}),!1})}}},{"../common/utils":6,"./product/autocomplete-product-name":8}],8:[function(t,e,a){"use strict";var n=t("bloodhound");e.exports={getName:function(t){var e=$(t);e.typeahead(null,{display:function(t){return t.value},templates:{suggestion:function(t){return'<div><img src="'+t.image+'?imageMogr2/thumbnail/32" />'+t.value+" </div>"}},highlight:!0,source:new n({datumTokenizer:n.tokenizers.obj.whitespace("value"),queryTokenizer:n.tokenizers.whitespace,remote:{url:"/admin/product/get-product",prepare:function(t,a){return a.data={name:e.val()},a}}})})},getId:function(t,e,a){$.ajax({url:"/admin/product/get-id/"+e,type:"get"}).then(function(n){n.success&&(t.value=n.result.name+" {id:"+e+"}",a())})}}},{bloodhound:10}],"product-category":[function(t,e,a){"use strict";e.exports={indexFun:function(){this.container=$(".am-accordion"),this.selectProductMethod(),this.addCategory1(),this.editCategory1(),this.removeCategory1(),this.moveCategory1Up(),this.moveCategory1Down(),this.addCategory2(),this.editCategory2(),this.removeCategory2(),this.moveCategory2Up(),this.moveCategory2Down(),this.keepStock()},selectProductMethod:function(){var t=$(".select-product-method");this.productMethodId=t.val()?parseInt(t.val()):0,t.change(function(){location.href="/admin/product-category?product-method-id="+this.value})},addCategory1:function(){var t=$("#modal-category-1-add"),e=$("#input-category-1-add"),a=$("#modal-category-1-confirm-add"),n=this.productMethodId;$(".btn-category-1-add").click(function(){e.val(""),t.modal({relatedTarget:this})}),a.click(function(){return a.data("state")?!1:($.AMUI.progress.start(),a.data("state",!0),$.post({url:leanApp.api+"classes/ProductCategory1",headers:leanAppHeader,data:JSON.stringify({index:$(".am-accordion-item").length,name:$.trim(e.val())?$.trim(e.val()):"无分类名",productMethodId:n}),success:function(){$.AMUI.progress.done(),a.data("state",!1),t.modal("close"),location.reload()}}),!1)})},editCategory1:function(){var t=$("#modal-category-1-edit"),e=$("#input-category-1-edit"),a=$("#modal-category-1-confirm-edit"),n=$("#modal-alert"),o=this.productMethodId,r=null;$(".edit-category-1").each(function(){$(this).click(function(){var a=$(this).parents(".am-accordion-title").find("strong").text();return e.val($.trim(a)),t.modal({relatedTarget:this}),r=$(this).parents(".am-accordion-item").attr("data-id"),!1})}),a.click(function(){return a.data("state")?!1:($.AMUI.progress.start(),a.data("state",!0),$.get({url:leanApp.api+"classes/ProductCategory1",headers:leanAppHeader,data:'where={"category1Id":'+r+"}"}).done(function(t){return $.ajax({type:"PUT",url:leanApp.api+"classes/ProductCategory1/"+t.results[0].objectId,headers:leanAppHeader,data:JSON.stringify({name:$.trim(e.val()),productMethodId:o})})}).done(function(){a.data("state",!1),$.AMUI.progress.done(),t.modal("close"),n.modal({onConfirm:function(){return location.reload()}}).find(".am-modal-bd").text("编辑一级分类成功!")}),!1)})},removeCategory1:function(){var t=$(".remove-category-1"),e=$("#modal-category-1-remove"),a=$("#modal-alert"),n=this.productMethodId;a.on("closed.modal.amui",function(){$(this).removeData("amui.modal")}),t.each(function(t,o){$(o).click(function(){$(this);return e.modal({relatedTarget:this,onConfirm:function(){var t=$(this.relatedTarget);return t.data("state")?!1:(t.data("state",!0),$.AMUI.progress.start(),$.get({url:"/admin/product-category/remove-category-1",data:{productMethodId:n,id:t.parents(".am-accordion-item").attr("data-id")},success:function(n){t.data("state",!1),$.AMUI.progress.done(),e.modal("close"),n.success?a.modal({onConfirm:function(){return location.reload()}}).find(".am-modal-bd").text("删除一级分类成功!"):a.modal().find(".am-modal-bd").text(n.message)}}),!1)}}),!1})})},moveCategory1Up:function(){$(".moveup-category-1").each(function(){$(this).click(function(){var t=$(this),e=t.parents(".am-accordion-item"),a=e.prev(),n=e.attr("data-id"),o=a.attr("data-id"),r=e.index();return 0===r?!1:t.data("state")?!1:(t.data("state",!0),$.AMUI.progress.start(),$.get({url:"/admin/product-category/move-category-1-up",data:{currentId:n,targetId:o}}).done(function(n){n.success&&(e.after(a),t.data("state",!1),$.AMUI.progress.done())}),!1)})})},moveCategory1Down:function(){var t=$(".am-accordion-item");$(".movedown-category-1").each(function(){$(this).click(function(){var e=$(this),a=e.parents(".am-accordion-item"),n=a.next(),o=a.attr("data-id"),r=n.attr("data-id"),i=a.index();return i===t.length-1?!1:e.data("state")?!1:(e.data("state",!0),$.AMUI.progress.start(),$.get({url:"/admin/product-category/move-category-1-down",data:{currentId:o,targetId:r}}).done(function(t){t.success&&(a.before(n),e.data("state",!1),$.AMUI.progress.done())}),!1)})})},addCategory2:function(){var t=$("#modal-category-2-add"),e=$("#input-category-2-add"),a=$("#modal-category-2-confirm-add"),n=null,o=null;$(".btn-category-2-add").each(function(a,r){$(r).click(function(){n=$(this).parents(".am-accordion-item"),o=parseInt(n.attr("data-id")),e.val(""),t.modal({relatedTarget:this})})}),a.click(function(){if(a.data("state"))return!1;$.AMUI.progress.start(),a.data("state",!0);var r=n.find(".category-2-list li").length;return $.post({url:"/admin/product-category/add-category-2",data:{index:r,name:$.trim(e.val())?$.trim(e.val()):"无标题",category1Id:o}}).done(function(e){$.AMUI.progress.done(),a.data("state",!1),t.modal("close");var o=$(".select-product-method").val(),r=n.data("id");n.find(".category-2-list").append('\n                        <li data-id="'+e.id+'">\n                            <strong>\n                            <a href="/admin/product?product-method-id='+o+"&category1-id="+r+"&category2-id="+e.id+'" target="_blank">'+e.name+'</a>\n                            </strong>\n                            <span class="options">\n                                <a href="/admin/product/add?product-method-id='+o+"&category1-id="+r+"&category2-id="+e.id+'" target="_blank">新建</a>\n                                <a class="edit-category-2" href="javascript:;">编辑</a>\n                                <a class="moveup-category-2" href="javascript:;">上移</a>\n                                <a class="movedown-category-2" href="javascript:;">下移</a>\n                                <a class="remove-category-2" href="javascript:;">删除</a>\n                            </span>\n                        </li>\n                ')}),!1})},editCategory2:function(){var t=$("#modal-category-2-edit"),e=$("#input-category-2-edit"),a=$("#modal-category-2-confirm-edit"),n=$("#modal-alert"),o=null,r=null;this.container.on("click",".edit-category-2",function(){return o=$(this).parents("li"),e.val($.trim(o.find("strong").text())),r=o.attr("data-id"),t.modal({relatedTarget:this}),!1}),a.click(function(){return a.data("state")?!1:($.AMUI.progress.start(),a.data("state",!0),$.get({url:leanApp.api+"classes/ProductCategory2",headers:leanAppHeader,data:'where={"category2Id":'+r+"}"}).done(function(t){return $.ajax({type:"PUT",url:leanApp.api+"classes/ProductCategory2/"+t.results[0].objectId,headers:leanAppHeader,data:JSON.stringify({name:$.trim(e.val())})})}).done(function(){a.data("state",!1),$.AMUI.progress.done(),t.modal("close"),n.modal({onConfirm:function(){return o.find("strong a").text(e.val())}}).find(".am-modal-bd").text("编辑二级分类成功!")}),!1)})},removeCategory2:function(){var t=$("#modal-category-2-remove"),e=$("#modal-alert");e.on("closed.modal.amui",function(){$(this).removeData("amui.modal")}),this.container.on("click",".remove-category-2",function(){return t.modal({relatedTarget:this,onConfirm:function(){var a=$(this.relatedTarget),n=a.parents("li");return a.data("state")?!1:(a.data("state",!0),$.AMUI.progress.start(),$.get({url:"/admin/product-category/remove-category-2",data:{category1Id:n.parents(".am-accordion-item").attr("data-id"),category2Id:n.attr("data-id")},success:function(o){a.data("state",!1),$.AMUI.progress.done(),t.modal("close"),o.success?e.modal({onConfirm:function(){return n.detach()}}).find(".am-modal-bd").text("删除二级分类成功!"):e.modal().find(".am-modal-bd").text(o.message)}}),!1)}}),!1})},moveCategory2Up:function(){this.container.on("click",".moveup-category-2",function(){var t=$(this),e=$(this).parents("li"),a=e.attr("data-id"),n=e.prev(),o=n.attr("data-id"),r=e.index();return 0===r?!1:t.data("state")?!1:(t.data("state",!0),$.AMUI.progress.start(),$.get({url:"/admin/product-category/move-category-2-up",data:{currentId:a,targetId:o}}).done(function(a){a.success&&(e.after(n),t.data("state",!1),$.AMUI.progress.done())}),!1)})},moveCategory2Down:function(){this.container.on("click",".movedown-category-2",function(){var t=$(this),e=$(this).parents("li"),a=e.attr("data-id"),n=e.next(),o=n.attr("data-id"),r=e.index();return r===e.parent().find("li").length-1?!1:t.data("state")?!1:(t.data("state",!0),$.AMUI.progress.start(),$.get({url:"/admin/product-category/move-category-2-down",data:{currentId:a,targetId:o}}).done(function(a){a.success&&(e.before(n),t.data("state",!1),$.AMUI.progress.done())}),!1)})},keepStock:function(){this.container.on("click",".keep-stock",function(){var t=$(this),e="true"===$(this).attr("data-outstock")?!0:!1,a=$(this).parents("li"),n=a.attr("data-id");$.get({url:leanApp.api+"classes/ProductCategory2",headers:leanAppHeader,data:'where={"category2Id":'+n+"}"}).done(function(t){return $.ajax({type:"PUT",url:leanApp.api+"classes/ProductCategory2/"+t.results[0].objectId,headers:leanAppHeader,data:JSON.stringify({isKeepStock:!e})})}).done(function(){e?(t.addClass("false"),t.text("下架(否)"),t.attr("data-outstock","false")):(t.removeClass("false"),t.text("下架(是)"),t.attr("data-outstock","true"))})})}}},{}],"product-brand":[function(t,e,a){"use strict";window.leanAppHeader;e.exports={indexFun:function(){var t=$(".remove-product-brand"),e=$("#confirm-remove-product-brand"),a=$("#modal-alert");a.on("closed.modal.amui",function(){$(this).removeData("amui.modal")}),t.click(function(){e.modal({relatedTarget:this,onConfirm:function(){var t=$(this.relatedTarget),n=parseInt(t.data("id"));return t.data("state")?!1:(t.data("state",!0),$.AMUI.progress.start(),$.ajax({type:"post",url:"/admin/product-brand/remove/"+n,success:function(n){t.data("state",!1),$.AMUI.progress.done(),e.modal("close"),n.success?a.modal({onConfirm:function(){return location.reload()}}).find(".am-modal-bd").text("删除产品类型成功!"):a.modal().find(".am-modal-bd").text(n.message)}}),!1)}})})},addFun:function(){this.submitControl()},editFun:function(){this.submitControl()},submitControl:function(){var t=$("#submit");$(".am-form").validator({submit:function(){return this.isFormValid()?void t.attr("disabled",!0).addClass("am-disabled"):!1}})},brandLogoUploadSuccess:function(t){$("#brand-logo-image-view").empty().addClass("on").append('<li><a href="'+t[0].url+'"><img src="'+t[0].url+'"/></a></li>'),$("#brand-logo-image").val(t[0].url)},authorUploadSuccess:function(t){$("#author-image-view").empty().addClass("on").append('<li><a href="'+t[0].url+'"><img src="'+t[0].url+'"/></a></li>'),$("#author-image").val(t[0].url)},imageUploadSuccess:function(t){var e=$("#brand-detail"),a=e.val();a+="\n\n"+t[0].url,e.val(a)}}},{}],product:[function(t,e,a){"use strict";var n=window.leanAppHeader,o=t("../common/utils");e.exports={indexFun:function(){var t=$(".select-category-1"),e=$(".select-category-2"),a=$(".select-order"),n=$(".select-product-method"),r=$("input[name=onsale]"),i=t.val(),c=e.val(),s=n.val(),d=r.val(),u=$("input[name=is-short-stock]").val(),l=$("input[name=update-stock-date]").val(),p=$("input[name=is-update-stock]").val(),m=$("input[name=hot]").val(),h=$("input[name=stock]").val(),f=$("input[name=search]").val(),v=$("input[name=is-translation]").val(),g=$("input[name=is-sales]").val();n.change(function(){return this.value?location.href=o.urlParamsComponent("/admin/product",{"product-method-id":this.value,onsale:d,"is-short-stock":u,"update-stock-date":l,"is-update-stock":p,hot:m,stock:h,"is-translation":v,"is-sales":g}):void(location.href=o.urlParamsComponent("/admin/product",{onsale:d,"is-short-stock":u,"update-stock-date":l,"is-update-stock":p,hot:m,stock:h,search:f,"is-translation":v,"is-sales":g}))}),t.change(function(){return this.value?location.href=o.urlParamsComponent("/admin/product",{"product-method-id":s,"category1-id":this.value,onsale:d,"is-short-stock":u,"update-stock-date":l,"is-update-stock":p,hot:m,stock:h,search:f,"is-translation":v,"is-sales":g}):void(location.href=o.urlParamsComponent("/admin/product",{"product-method-id":s,onsale:d,"is-short-stock":u,"update-stock-date":l,"is-update-stock":p,hot:m,stock:h,search:f,"is-translation":v,"is-sales":g}))}),e.change(function(){return this.value?location.href=o.urlParamsComponent("/admin/product",{"product-method-id":s,"category1-id":i,"category2-id":this.value,onsale:d,"is-short-stock":u,"update-stock-date":l,"is-update-stock":p,hot:m,stock:h,search:f,"is-translation":v,"is-sales":g}):void(location.href=o.urlParamsComponent("/admin/product",{"product-method-id":s,"category1-id":i,onsale:d,"is-short-stock":u,"update-stock-date":l,"is-update-stock":p,hot:m,stock:h,search:f,"is-translation":v,"is-sales":g}))}),r.change(function(){location.href=o.urlParamsComponent("/admin/product",{"product-method-id":s,"category1-id":i,"category2-id":c,onsale:this.value,"is-short-stock":u,"update-stock-date":l,"is-update-stock":p,hot:m,stock:h,search:f,"is-translation":v,"is-sales":g})}),a.change(function(){return location.href=o.urlParamsComponent("/admin/product",{"product-method-id":s,"category1-id":i,"category2-id":c,onsale:d,"is-short-stock":u,"update-stock-date":l,"is-update-stock":p,order:this.value,hot:m,stock:h,search:f,"is-translation":v,"is-sales":g})}),$(function(){var t=[];$(".remove-product").each(function(e){t.push($(this).attr("data-id"))}),$.ajax({type:"get",url:"/admin/product/get-sales",data:{"product-ids":t}}).then(function(t){var e=$("table tbody tr"),a=new Date,n=a.getMonth(),o=n-1;0==n&&(n=12,o=11),1==n&&(o=12),$.each(t.data,function(t,a){e.each(function(){a.productId==$(this).attr("data-product-id")&&($(this).find(".title").attr("data-popover-thirty",a.thirty),$(this).find(".title").attr("data-popover-ninety",a.ninety),$(this).find(".title").attr("data-popover-last-month",a.lastMonty),$(this).find(".title").attr("data-popover-two-month",a.twoMonty))})}),e.each(function(){var t=$(this).find(".title"),e=t.data("popover-sales")<t.data("popover-thirty")?t.data("popover-sales"):t.data("popover-thirty"),a=t.data("popover-sales")<t.data("popover-ninety")?t.data("popover-sales"):t.data("popover-ninety"),r=t.data("popover-sales")<t.data("popover-two-month")?t.data("popover-sales"):t.data("popover-two-month"),i=t.data("popover-sales")<t.data("popover-last-month")?t.data("popover-sales"):t.data("popover-last-month");t.popover({content:"成本价:￥"+t.data("popover-cost-price")+" | 定价: ￥"+t.data("popover-price")+" | 最低批发价: "+t.data("popover-source-price")+"<br/>30天销量: "+e+" | 90天销量: "+a+" <br/>  "+o+"月份销量: "+r+" | "+n+"月份销量: "+i+"  <br/>总销量: "+t.data("popover-sales"),trigger:"hover"})}),$(".recommend-purchase").removeAttr("disabled")})});var k=$("#modal-alert");$(".remove-product").click(function(){return $("#confirm-remove-product").modal({relatedTarget:this,onConfirm:function(){var t=this,e=$(this.relatedTarget),a=e.attr("data-id");$.ajax({type:"post",url:"/admin/product/remove/"+a}).then(function(){k.modal({relatedTarget:t,onConfirm:function(){var e=$(t.relatedTarget);e.parents("tr").detach()}}).find(".am-modal-bd").text("删除产品成功!")})},onCancel:function(){return!1}}),!1}),$(".am-table").on("mousedown",".am-icon-link",function(){$(this).addClass("on")}),setTimeout(function(){if(/product-id=\d+/.test(location.search)){var t=/product-id=(\d+)/.exec(location.search)[1],e=$("tr[data-product-id="+t+"]");e.addClass("on"),$("html,body").animate({scrollTop:e.offset().top})}},0);var y=$("#modal-viewport"),b=y.find(".am-modal-bd");$(".link-modal-viewport").click(function(){b.append('<iframe class="iframe-viewport" src="" frameborder="0"></iframe>');var t=y.find("iframe"),e=$(this).attr("href");return t.attr("src",e),y.modal({width:800,height:520}),!1}),y.on("close.modal.amui",function(){b.empty()});var x=$(".form-copy-product-content"),C=$("#modal-confirm"),w=$("#modal-alert");x.find(".am-btn").click(function(){var t=parseInt($(this).parents("tr").data("product-id"));if(""===x.serialize())return w.modal({relatedTarget:this}).find(".am-modal-bd").text("请选择需要复制的内容"),!1;var e=[];x.find("input[type=checkbox]:checked").each(function(){e.push(this.name)}),C.modal({relatedTarget:this,onConfirm:function(){var a=this;$.ajax({url:"/admin/product/product-copy",type:"post",data:{productId:t,field:e}}).then(function(t){t.success&&w.modal({relatedTarget:a,onConfirm:function(){location.reload()}}).find(".am-modal-bd").text("复制成功!")})}})});var I=$("#modal-copy-etsy"),T=$(".input-copy-etsy"),j=$("#modal-loading");$(".link-copy-etsy").click(function(){var t=$(this).data("product-id");return j.find(".am-modal-hd").text("正在导入..."),I.modal({relatedTarget:this,onConfirm:function(e){return $.trim(T.val())&&-1!==$.trim(T.val()).indexOf("etsy.com")?($.ajax({url:"/admin/product/spider-info",data:{"product-id":t,url:$.trim(T.val())}}).then(function(t){t.code?(j.find(".am-modal-hd").text("导入成功!正在更新..."),setTimeout(function(){location.reload()},1e3)):(j.find(".am-modal-hd").text("导入失败,请重试!"),setTimeout(function(){j.modal("close")},1e3))},function(t){console.info(t),j.find(".am-modal-hd").text("导入失败,请重试!"),setTimeout(function(){j.modal("close")},1e3)}),void j.modal()):void alert("请输入正确的etsy.com链接")}}),T[0].focus(),!1});var A=$("#modal-bind-category"),S=$(".input-bind-category"),O=$("#modal-loading");$(".link-bind-category").click(function(){var t=$(this).data("product-id");O.find(".am-modal-hd").text("正在修改..."),A.modal({relatedTarget:this,onConfirm:function(e){$.ajax({type:"post",url:"/admin/product/set-parent-product",data:{productId:t,parentProductId:S.val()}}).then(function(t){O.find(".am-modal-hd").text("关联成功!正在更新..."),setTimeout(function(){location.reload()},1e3)},function(t){console.info(t),O.find(".am-modal-hd").text("关联失败,请重试!"),setTimeout(function(){O.modal("close")},1e3)}),O.modal()}}),S[0].focus()});var D=$("#modal-change-price"),M=$(".input-change-price"),q=$("#modal-loading");$(".link-change-price").click(function(){var t=$(this).data("product-id"),e=$(this).data("category2-id");return q.find(".am-modal-hd").text("正在修改..."),D.modal({relatedTarget:this,onConfirm:function(a){$.trim(M.val())?($.ajax({type:"post",url:"/admin/product/sync-price",data:{productId:t,price:$.trim(M.val()),category2Id:e}}).then(function(t){q.find(".am-modal-hd").text("修改成功!正在更新..."),setTimeout(function(){location.reload()},1e3)},function(t){console.info(t),q.find(".am-modal-hd").text("修改失败,请重试!"),setTimeout(function(){q.modal("close")},1e3)}),q.modal()):alert("请输入正确的价格")}}),M[0].focus(),!1});var F=$("#modal-change-price"),U=$(".input-change-price"),L=$("#modal-loading");$(".link-change-cost-price").click(function(){var t=$(this).data("product-id"),e=$(this).data("category2-id");return L.find(".am-modal-hd").text("正在修改..."),F.modal({relatedTarget:this,onConfirm:function(a){$.trim(U.val())?($.ajax({type:"post",url:"/admin/product/sync-cost-price",data:{productId:t,costPrice:$.trim(U.val()),category2Id:e}}).then(function(t){L.find(".am-modal-hd").text("修改成功!正在更新..."),setTimeout(function(){location.reload()},1e3)},function(t){console.info(t),L.find(".am-modal-hd").text("修改失败,请重试!"),setTimeout(function(){L.modal("close")},1e3)}),L.modal()):alert("请输入正确的价格")}}),U[0].focus(),!1});var N=$("#modal-change-price"),E=$(".input-change-price"),P=$("#modal-loading");$(".link-change-wholesale-price").click(function(){var t=$(this).data("product-id"),e=$(this).data("category2-id");return P.find(".am-modal-hd").text("正在修改..."),N.modal({relatedTarget:this,onConfirm:function(a){$.trim(E.val())?($.ajax({type:"post",url:"/admin/product/sync-wholesale-price",data:{productId:t,wholesalePrice:$.trim(E.val()),category2Id:e}}).then(function(t){P.find(".am-modal-hd").text("修改成功!正在更新..."),setTimeout(function(){location.reload()},1e3)},function(t){P.find(".am-modal-hd").text("修改失败,请重试!"),setTimeout(function(){P.modal("close")},1e3)}),P.modal()):alert("请输入正确的价格")}}),E[0].focus(),!1});var z=$("#modal-change-binding-product"),H=$(".input-change-binding-id"),_=$(".input-change-binding-number"),B=$("#modal-loading");$(".link-change-binding-product").click(function(){var t=$(this).data("product-id");return B.find(".am-modal-hd").text("正在绑定..."),z.modal({relatedTarget:this,onConfirm:function(e){$.trim(H.val())?($.ajax({type:"post",url:"/admin/product/set-binding-product",data:{productId:t,bindingId:$.trim(H.val()),bindingNumber:$.trim(_.val())}}).then(function(t){B.find(".am-modal-hd").text("绑定成功!正在更新..."),setTimeout(function(){location.reload()},1e3)},function(t){B.find(".am-modal-hd").text("绑定失败,请重试!"),setTimeout(function(){B.modal("close")},1e3)}),B.modal()):alert("请输入正确的产品ID")}}),input[0].focus(),!1}),$(".copy-product-title").each(function(t,e){var a=new Clipboard(e,{text:function(){return $(e).data("text")+" {"+$(e).data("id")+"}"}});a.on("success",function(t){$(e).addClass("on")})}),$(".image-source-download").click(function(){var t=$(this).next(),e=t.find(".image-source-value").val().split("\n");$(this).data("product-id");e.length&&($.each(e,function(e,a){t.append('<a href="'+a+'" download>download</a>')}),t.find("a").each(function(){var t=document.createEvent("MouseEvents");t.initEvent("click",!0,!1),this.dispatchEvent(t)}))}),$(".set-onsale").click(function(){var t=this,e="true"===$(this).attr("isonsale")?!1:!0,a=$(this).parents("tr").data("product-id"),n=$(this).parents("tr").find(".title");$.ajax({type:"post",url:"/admin/product/set-onsale/"+a,data:{isOnsale:e}}).then(function(a){a.success&&(e?(n.removeClass("product-out"),$(t).attr("isonsale","true"),$(t).removeClass("off")):(n.addClass("product-out"),$(t).attr("isonsale","false"),$(t).addClass("off")))})}),$(".set-hot").click(function(){var t=this,e="true"===$(this).attr("ishot")?!1:!0,a=$(this).parents("tr").data("product-id"),n=$(this).parents("tr").find(".title");$.ajax({type:"post",url:"/admin/product/set-hot/"+a,data:{isHot:e}}).then(function(a){a.success&&(e?(n.append('<sup class="hot"></sup>'),n.addClass("product-hot"),$(t).attr("ishot","true")):(n.find("sup").detach(),n.addClass("product-hot"),$(t).attr("ishot","false")))})}),$(".set-short-stock").click(function(){var t=this,e="true"===$(this).attr("isshortstock")?!1:!0,a=$(this).parents("tr").data("product-id");$.ajax({type:"post",url:"/admin/product/set-short-stock/"+a,data:{isShortStock:e}}).then(function(a){a.success&&(e?($(t).addClass("on"),$(t).attr("isshortstock","true")):($(t).removeClass("on"),$(t).attr("isshortstock","false")))})}),$(".set-update-stock:not(.on)").each(function(){}),$(".update-totaobao-confirm").click(function(){var t=$(this).parent(),e=t.find(".update-totaobao-image"),a=t.find(".update-totaobao-title"),n=t.find(".update-totaobao-content"),o=t.find(".update-totaobao-price"),r=t.find(".update-totaobao-category"),i=$(this).data("product-id"),c=$("tr[data-product-id="+i+"]").find(".set-update-stock");$.ajax({type:"post",url:"/admin/product/set-update-stock/"+i,data:{isUpdateStock:!0,updateTotaobaoImage:e.prop("checked"),updateTotaobaoTitle:a.prop("checked"),updateTotaobaoContent:n.prop("checked"),updateTotaobaoPrice:o.prop("checked"),updateTotaobaoCategory:r.prop("checked")}}).then(function(t){t.success&&(c.addClass("on"),c.attr("isupdatestock","true")),c.popover("close")})}),$(".set-update-stock.on").click(function(){var t=this,e=$(this).parents("tr").data("product-id");$.ajax({type:"post",url:"/admin/product/set-update-stock/"+e,data:{isUpdateStock:!1}}).then(function(e){e.success&&($(t).removeClass("on"),$(t).attr("isupdatestock","false"))})}),$(".set-warning-stock.on").click(function(){var t=this,e=$(this).parents("tr").data("product-id");$.ajax({type:"post",url:"/admin/product/set-update-stock-date/"+e,data:{updateStockDate:!0}}).then(function(e){e.success&&$(t).removeClass("on")})}),$(".set-discount").click(function(){var t=this,e=parseInt($(this).attr("data-state"));0===e?e=2:1===e?e=3:2===e?e=1:3===e?e=4:4===e?e=5:5===e&&(e=0);var a=$(this).parents("tr").data("product-id");$.ajax({type:"post",url:"/admin/product/set-is-sales/"+a,data:{state:e}}).then(function(a){$(t).attr("data-state",e),1===e?$(t).removeClass("on-2").removeClass("on-3").removeClass("on-4").addClass("on-1"):2===e?$(t).removeClass("on-1").removeClass("on-3").removeClass("on-4").addClass("on-2"):3===e?$(t).removeClass("on-1").removeClass("on-2").removeClass("on-4").addClass("on-3"):4===e?$(t).removeClass("on-1").removeClass("on-2").removeClass("on-3").addClass("on-4"):5===e?$(t).removeClass("on-1").removeClass("on-2").removeClass("on-3").removeClass("on-4").addClass("on-5"):0===e&&$(t).removeClass("on-1").removeClass("on-2").removeClass("on-3").removeClass("on-4").removeClass("on-5")})}),$(".set-product-trans").click(function(){var t=this,e="true"===$(this).attr("istranslationdate")?!1:!0,a=$(this).parents("tr").data("product-id");$.ajax({type:"post",url:"/admin/product/set-is-translation/"+a,data:{isTranslation:e}}).then(function(a){e?($(t).addClass("on"),$(t).attr("istranslationdate","true")):($(t).removeClass("on"),$(t).attr("istranslationdate","false"))})}),$(".set-product-parent").click(function(){window.location.href="/admin/product?parent-product-id="+$(this).attr("parentProductId")}),$(".set-product-parent").each(function(){var t=$(this).parents("tr");if(!t.hasClass("main-product-row")){var e=parseInt($(this).attr("parentproductid")),a=$(".main-product-row[data-product-id="+e+"]");a.length&&(t.addClass("sub-product-row"),a.after(t))}});var R=[];$(".purchase-link a").each(function(){$(this).attr("href").indexOf("wisdomproducts.com")>-1&&R.push(!0)}),R.length?$(".check-wisdomproducts-stock").click(function(){var t=$(this),e=$(this).text();$(this).text("检测中..."),$(".wisdom-check-info").detach(),$(this).prop("disabled",!0);var a=$(".purchase-link").length,n=0;$(".purchase-link a").each(function(){var o=$(this).parent().data("product-id");$(this).attr("href").indexOf("wisdomproducts.com")>-1&&$.ajax({url:"/admin/product/check-wisdom-products-stock",data:{productId:o,url:$(this).attr("href")}}).then(function(r){n++,a===n&&(t.prop("disabled",!1),t.text(e));var i="缺货"===r.message?"outstock":"",c=$(".am-table tr[data-product-id="+o+"]");c.find(".product-title").append('<span class="wisdom-check-info '+i+'">['+r.message+"]</span>"),i&&c.addClass("no-wisdom-stock")})})}):$(".check-wisdomproducts-stock").prop("disabled",!0);var J=$(".hide-wisdomproducts-outstock");$.cookie("hide-wisdomproducts-outstock")&&(J.prop("checked",!0),$("#product-list").addClass("hide-no-wisdom")),J.click(function(){this.checked?($.cookie("hide-wisdomproducts-outstock","true",{expires:new Date((new Date).getTime()+31536e6),path:"/",domain:location.host}),$("#product-list").addClass("hide-no-wisdom")):($.cookie("hide-wisdomproducts-outstock","",{expires:new Date((new Date).getTime()),path:"/",domain:location.host}),$("#product-list").removeClass("hide-no-wisdom"))});var Y=$(".hide-nosale-product");$.cookie("hide-nosale-product")&&(Y.prop("checked",!0),$(".set-discount.on-5").each(function(t,e){$(this).parents(".product-row").addClass("hide-nosale")}),$(".set-discount.on-1").each(function(t,e){$(this).parents(".product-row").addClass("hide-nosale")})),Y.click(function(){this.checked?($.cookie("hide-nosale-product","true",{expires:new Date((new Date).getTime()+31536e6),path:"/",domain:location.host}),$(".set-discount.on-5").each(function(t,e){$(this).parents(".product-row").addClass("hide-nosale")}),$(".set-discount.on-1").each(function(t,e){$(this).parents(".product-row").addClass("hide-nosale")})):($.cookie("hide-nosale-product","",{expires:new Date((new Date).getTime()),path:"/",domain:location.host}),$(".product-row.hide-nosale").removeClass("hide-nosale"))});var V=$(".product-out"),G=$(".hide-outstock-product");$.cookie("hide-outstock-product")&&(G.prop("checked",!0),V.each(function(t,e){$(e).parents("tr").removeClass("hide-no-product")})),G.click(function(){this.checked?($.cookie("hide-outstock-product","true",{expires:new Date((new Date).getTime()+31536e6),path:"/",domain:location.host}),V.each(function(t,e){$(e).parents("tr").addClass("hide-no-product")})):($.cookie("hide-outstock-product","",{expires:new Date((new Date).getTime()),path:"/",domain:location.host}),V.each(function(t,e){$(e).parents("tr").removeClass("hide-no-product")}))});var Z=$(".hide-nostock-product");$.cookie("hide-nostock-product")&&(Z.prop("checked",!0),$(".stock-num.none").each(function(t,e){$(this).parents(".product-row").addClass("hide-no-product")})),Z.click(function(){this.checked?($.cookie("hide-nostock-product","true",{expires:new Date((new Date).getTime()+31536e6),path:"/",domain:location.host}),$(".stock-num.none").each(function(t,e){$(this).parents(".product-row").addClass("hide-no-product")})):($.cookie("hide-nostock-product","",{expires:new Date((new Date).getTime()),path:"/",domain:location.host}),$(".product-row.hide-no-product").removeClass("hide-no-product"))});var W=$(".hide-maximum-product");$.cookie("hide-maximum-productk")&&(W.prop("checked",!0),$(".maximum.off").each(function(t,e){$(this).parents(".product-row").addClass("hide-maximum")})),W.click(function(){this.checked?($.cookie("hide-maximum-productk","true",{expires:new Date((new Date).getTime()+31536e6),path:"/",domain:location.host}),$(".maximum.off").each(function(t,e){$(this).parents(".product-row").addClass("hide-maximum")})):($.cookie("hide-maximum-productk","",{expires:new Date((new Date).getTime()),path:"/",domain:location.host}),$(".product-row.hide-maximum").removeClass("hide-maximum"))}),$(".recommend-purchase").click(function(){$(".recommend-purchase-info").detach(),$(".product-row").each(function(t,e){var a=parseInt($(e).find(".title").attr("data-popover-thirty")),n=parseInt($(e).find(".title").attr("data-popover-ninety")),o=parseInt($(e).find(".title").attr("data-popover-last-month")),r=parseInt($(e).find(".title").attr("data-popover-two-month")),i=(parseInt($(e).find(".title").attr("data-popover-sales")),parseInt($(e).find(".am-icon-inbox .stock-num").text())),c=parseInt($(e).find(".am-icon-arrow-circle-o-down .stock-num").text())||0,s=0,d=parseInt($(e).find(".title").attr("data-createdate")),u=new Date(d).getFullYear(),l=new Date(d).getMonth()+1,p=(new Date).getFullYear(),m=(new Date).getMonth()+1;s=12*(p-u)+(m-l);var h=i+c,f=Math.max.apply(null,[a,parseInt(n/3),o,r]),v=3*f-h;0>=v?v="":(v=Math.ceil(v),v="<strong>[推荐预定数:"+v+"]</strong>"),$(e).find(".product-title").append('<span class="recommend-purchase-info">'+v+"</span>")})}),1===$(".set-product-parent").length&&1===$(".am-table").find("tbody tr").length&&$(".set-product-parent").click(),$(".set-outstock-off").click(function(){var t=this,e="true"===$(this).attr("isstockdate")?!1:!0,a=$(this).parents("tr").data("product-id");$.ajax({type:"post",url:"/admin/product/set-stock/"+a,data:{isStock:e}}).then(function(a){e?($(t).addClass("on"),$(t).attr("isstockdate","true")):($(t).removeClass("on"),
$(t).attr("isstockdate","false"))})});var K=$("#modal-change-discount"),X=$(".input-change-discount"),Q=$("#modal-loading");$(".link-change-discount").click(function(){var t=$(this).data("product-id");return Q.find(".am-modal-hd").text("正在修改..."),K.modal({relatedTarget:this,onConfirm:function(e){$.trim(X.val())?($.ajax({type:"post",url:"/admin/product/set-discount",data:{productId:t,discount:$.trim(X.val())}}).then(function(t){Q.find(".am-modal-hd").text("修改成功!正在更新..."),setTimeout(function(){location.reload()},1e3)},function(t){console.info(t),Q.find(".am-modal-hd").text("修改失败,请重试!"),setTimeout(function(){Q.modal("close")},1e3)}),Q.modal()):alert("请输入正确的折扣")}}),X[0].focus(),!1});var tt=$("#modal-change-category-discount"),et=$(".input-change-category-discount"),at=$("#modal-loading");$(".link-change-category-discount").click(function(){var t=$(this).data("product-id"),e=$(this).data("category2-id");return at.find(".am-modal-hd").text("正在修改..."),tt.modal({relatedTarget:this,onConfirm:function(a){$.trim(et.val())?($.ajax({type:"post",url:"/admin/product/set-category-discount",data:{productId:t,discount:$.trim(et.val()),category2Id:e}}).then(function(t){at.find(".am-modal-hd").text("修改成功!正在更新..."),setTimeout(function(){location.reload()},1e3)},function(t){console.info(t),at.find(".am-modal-hd").text("修改失败,请重试!"),setTimeout(function(){at.modal("close")},1e3)}),at.modal()):alert("请输入正确的折扣")}}),et[0].focus(),!1});var nt=$("#modal-change-maximum"),ot=$(".input-change-maximum"),rt=$("#modal-loading");$(".link-change-maximum").click(function(){var t=$(this).data("product-id");return rt.find(".am-modal-hd").text("正在修改..."),nt.modal({relatedTarget:this,onConfirm:function(e){$.trim(ot.val())?($.ajax({type:"post",url:"/admin/product/set-maximum",data:{productId:t,maximum:$.trim(ot.val())}}).then(function(t){rt.find(".am-modal-hd").text("修改成功!正在更新..."),setTimeout(function(){location.reload()},1e3)},function(t){console.info(t),rt.find(".am-modal-hd").text("修改失败,请重试!"),setTimeout(function(){rt.modal("close")},1e3)}),rt.modal()):alert("请输入正确的数量")}}),ot[0].focus(),!1});var it=$("#modal-change-category-maximum"),ct=$(".input-change-category-maximum"),st=$("#modal-loading");$(".link-change-category-maximum").click(function(){var t=$(this).data("product-id"),e=$(this).data("category2-id");return st.find(".am-modal-hd").text("正在修改..."),it.modal({relatedTarget:this,onConfirm:function(a){$.trim(ct.val())?($.ajax({type:"post",url:"/admin/product/set-category-maximum",data:{productId:t,maximum:$.trim(ct.val()),category2Id:e}}).then(function(t){st.find(".am-modal-hd").text("修改成功!正在更新..."),setTimeout(function(){location.reload()},1e3)},function(t){console.info(t),st.find(".am-modal-hd").text("修改失败,请重试!"),setTimeout(function(){st.modal("close")},1e3)}),st.modal()):alert("请输入正确的数量")}}),ct[0].focus(),!1});var dt=$("#modal-change-color-tag"),ut=$(".input-change-color-tag"),lt=$("#modal-loading");$(".link-change-color-tag").click(function(){var t=$(this).data("product-id");return lt.find(".am-modal-hd").text("正在修改..."),dt.modal({relatedTarget:this,onConfirm:function(e){$.trim(ut.val())?($.ajax({type:"post",url:"/admin/product/set-color-tag",data:{productId:t,colorTag:$.trim(ut.val())}}).then(function(t){lt.find(".am-modal-hd").text("修改成功!正在更新..."),setTimeout(function(){location.reload()},1e3)},function(t){console.info(t),lt.find(".am-modal-hd").text("修改失败,请重试!"),setTimeout(function(){lt.modal("close")},1e3)}),lt.modal()):alert("请输入正确的数量")}}),ut[0].focus(),!1});var pt=$("#modal-change-color-tags"),mt=$(".input-change-color-tags"),ht=$("#modal-loading");$(".link-change-color-tags").click(function(){var t=$(this).data("product-id"),e=$(this).data("category2-id");return ht.find(".am-modal-hd").text("正在修改..."),pt.modal({relatedTarget:this,onConfirm:function(a){$.trim(mt.val())?($.ajax({type:"post",url:"/admin/product/set-color-tags",data:{productId:t,colorTag:$.trim(mt.val()),category2Id:e}}).then(function(t){ht.find(".am-modal-hd").text("修改成功!正在更新..."),setTimeout(function(){location.reload()},1e3)},function(t){ht.find(".am-modal-hd").text("修改失败,请重试!"),setTimeout(function(){ht.modal("close")},1e3)}),ht.modal()):alert("请输入正确的标识号")}}),mt[0].focus(),!1})},addFun:function(){this.setCategory(),this.chooseBanner("add"),this.submitControl(),this.setImageList(),this.setZclip(),this.saveData()},editFun:function(){this.setCategory(),this.chooseBanner(),this.submitControl(),this.setImageList(),this.setZclip(),this.saveData()},setCategory:function(){var t=$(".category-group"),e=$(".btn-add-category"),a=this;t.on("change",".select-product-method",function(){var t=$(this),e=t.parents(".group"),o=e.find(".select-category-1"),r=e.find(".select-category-2");if(!this.value)return!1;if(a.isSubmitBtn)return!1;var i=parseInt(this.value);$.get({url:leanApp.api+"classes/ProductCategory1",headers:n,data:'where={"productMethodId":'+i+"}"}).done(function(t){o.find("option:not(:first)").detach(),r.find("option:not(:first)").detach();var e="";$.each(t.results,function(t,a){e+='<option value="'+a.category1Id+'">'+a.name+"</option>"}),o.append(e)})}),t.on("change",".select-category-1",function(){var t=$(this).parents(".group"),e=t.find(".select-category-2");if(!this.value)return!1;if(a.isSubmitBtn)return!1;var o=parseInt(this.value);$.get({url:leanApp.api+"classes/ProductCategory2",headers:n,data:'where={"category1Id":'+o+"}"}).done(function(t){e.find("option:not(:first)").detach();var a="";$.each(t.results,function(t,e){a+='<option value="'+e.category2Id+'">'+e.name+"</option>"}),e.append(a)})}),t.on("click",".btn-remove-category",function(){$(this).parents(".group").detach()}),e.click(function(){var e=$(this).parents(".group"),a=e.clone();a.find(".am-selected").detach(),a.find("select").removeAttr("required"),a.appendTo(t),a.find(".select-category-1 option:not(:first)").detach(),a.find(".select-category-2 option:not(:first)").detach(),a.find(".btn-add-category").removeClass("btn-add-category").addClass("btn-remove-category").text("删除"),a.find("label").detach()})},chooseBanner:function(t){var e=$("#select-banner"),a=$(".banner-view"),n=$("#banner"),o=$(".select-banner-random");e.on("change",function(){var t=e.find("option:selected").attr("data-src");a.removeClass("hide"),a.html('<img width="300" src="'+t+'"/>'),n.val(t)}),o.click(function(){var t=Math.floor(Math.random()*(e.find("option").length-1));e.find("option").get(t).selected=!0,e.trigger("change")}),"add"===t&&setTimeout(function(){o.click()},1e3)},setImageList:function(){var t=this,e=$(".image-list"),a=$("#detail-image");e.on("click",".move",function(){var e=$(this).parents("li");return 0===e.index()?!1:(e.after(e.prev()),void t.updateMainImage())}),e.on("click",".remove",function(){var e=$(this).parents("li"),n=e.find("img").attr("src");n=n.replace("?imageMogr2/thumbnail/100",""),n="![]("+n+")";var o=a.val().replace(n,"");a.val($.trim(o)),e.detach(),t.updateMainImage()}),e.on("click","input[type=checkbox]",function(){t.updateMainImage()}),$(".check-all-images").click(function(){setTimeout(function(){$(".image-list").find("input:unchecked").click()},1)}),$(".copy-all-images").click(function(){var t=$("#detail-image"),e=$(".image-list");e.find(".img-link").each(function(e,a){t[0].value+="![]("+$(a).attr("href")+")\n"})})},submitControl:function(){var t=$("#submit"),e=this;e.isSubmitBtn=!1,$("form :submit").click(function(){var t=$(this);return e.isSubmitBtn=!0,$("form").attr({action:t.data("action"),target:t.data("target")}),"submit"===this.id&&t.data("state",t[0].id),setTimeout(function(){e.isSubmitBtn=!1,"submit"===this.id&&t.data("state",!1)}.bind(this),1e3),!0}),$(".am-form").validator({submit:function(){var e=/魔法油|符咒|巫术|占卜|通灵|改运|消灾|避祸/;return e.test($("#name").val()),e.test($("#review").val()),e.test($("#detail").val()),e.test($("#property").val()),e.test($("#instruction").val()),e.test($("#use").val()),this.isFormValid()?void("submit"===t.data("state")&&t.attr("disabled",!0).addClass("am-disabled")):!1}})},uploadFileSuccess:function(t){var e=$(".image-list");$.each(t,function(t,a){e.append('<li data-id="'+a.id+'" class="am-cf"><div class="am-fl"><input type="checkbox" /></div><div class="am-fr"><p><a class="img-link" href="'+a.url+'" target="_blank"><img src="'+a.url+'?imageMogr2/thumbnail/100"/></a></p><p><a class="move" href="javascript:;">前移</a> | <span class="copy"><a class="copy-url" href="javascript:;">复制</a></span> | <a class="remove" href="javascript:;">删除</a></p></div></li>')}),this.updateMainImage()},updateMainImage:function(){var t=$("#main-image"),e=$(".image-list"),a={};e.find("input[type=checkbox]").each(function(){var t=$(this).parents("li");a[t.data("id")]={url:t.find(".img-link").attr("href"),isMainImage:this.checked}}),t.val(JSON.stringify(a)),this.setZclip()},setZclip:function(){var t=$("#detail-image"),e=$(".image-list");$(".zclip").detach(),e.find(".copy-url").detach(),e.find(".copy").append('<a class="copy-url" href="javascript:;">复制</a>'),e.find(".copy-url").each(function(){var a=this,n=$(this),o=new Clipboard(this,{text:function(){return"![]("+n.parents("li").find(".img-link").attr("href")+")"}});o.on("success",function(n){e.find(".oncopy").removeClass("oncopy"),$(a).addClass("oncopy");var o=t.val();$.trim(o)?t.val(o+"\n"+n.text):t.val(o+n.text)})})},saveData:function(){$(document).on("keydown",function(t){13===t.keyCode&&t.ctrlKey&&$("#submit").click()})}}},{"../common/utils":6}],order:[function(t,e,a){"use strict";t("jquery-validate");var n=t("bloodhound"),o=t("../common/utils");e.exports={indexFun:function(){function t(t){var e=$("#modal-set-stock"),a=parseInt(t.attr("product-count"));setTimeout(function(){for(var t=0;a>t;t++)e.find(".stock-minus").click()},1e3),setTimeout(function(){e.find(".stock-save").click()},1500)}function e(){location.href=o.urlParamsComponent("/order/order",{limit:$("#limit").val(),"search-not-shipped":$("#search-not-shipped").val(),"search-shipping":$("#search-shipping").val()})}var a=!1,n=$(".btn-one-update-stock"),r=$("#modal-update-stock-confirm"),i=$("#modal-update-alert");n.each(function(t,e){$(e).click(function(){var t=$(this).parents("tr"),e=t.find(".set-stock"),n=$(this),o=1,c="",s="";return t.find(".update-stock .on")[0]?(alert("订单中含有已更新库存产品，请去除勾选后重新更新!"),!1):(t.find(".order-split").filter(function(){return!$(this).hasClass("is-parent-product")}).filter(function(){return $(this).find(".set-stock")[0]?!0:!1}).each(function(t,e){var a=$(e).data("count"),n=$(e).data("stock");if(a==n)c="<strong>发现存在库存数即将无库存的产品：</strong>",s+='<div class="stock-list">'+($(e).find(".image").html()+" "+$(e).find(".product-title").html())+"</div>",o=2;else if(a>n)return c="<strong>无法执行，请手动操作！<br/>发现发货数小于库存数的产品：</strong>",s='<div class="stock-list">'+($(e).find(".image").html()+" "+$(e).find(".product-title").html())+"</div>",o=3,!1}),void(1===o?(n.attr("disabled",!0),n.find("span").text("更新中，请勿操作"),a=!0,setTimeout(function(){e.eq(0).click()},1500)):2===o?(r.modal({relatedTarget:this,onConfirm:function(t){n.attr("disabled",!0),n.find("span").text("更新中，请勿操作"),a=!0,setTimeout(function(){e.eq(0).click()},1500)}}),r.find(".am-modal-hd").html(c),r.find(".am-modal-bd").html(s)):3===o&&(i.modal(),i.find(".am-modal-hd").html(c),i.find(".am-modal-bd").html(s))))})}),$(".remove-order").click(function(){var t=$(this);return $("#confirm-remove-order").modal({relatedTarget:this,onConfirm:function(e){location.href=t.attr("href")},onCancel:function(){return!1}}),!1});var c={customerId:[],orderId:[]},s=$(".am-table").find("tr[data-customer-id]");s.each(function(t,e){$(e).data("customer-id")&&(c.customerId.push($(e).data("customer-id")),c.orderId.push($(e).data("order-id")))}),$.ajax({url:"/order/order/get-customer",data:{queryData:c}}).then(function(t){t.success&&$.each(s,function(e,a){var n=parseInt($(a).data("customer-id"));$.each(t.shippings,function(t,e){e.customerId===n&&$(a).find(".customer-name").addClass("shunfeng")})})});var d=[],u=$(".image");u.each(function(t,e){$(e).data("id")&&d.push($(e).data("id"))}),$.ajax({url:"/order/order/get-image",data:{productId:d.join()}}).then(function(t){t.success&&$.each(u,function(e,a){var n=parseInt($(a).data("id"));if($.isEmptyObject(t.images))$(a).removeClass("on").html('<img width="60" src="//lc-joabcrtt.cn-n1.lcfile.com/d4c225054f005a4d7d39.png?imageMogr2/thumbnail/60"/>');else for(var o in t.images)parseInt(o)===n?$(a).removeClass("on").html('<a href="'+t.images[o]+'" target="_blank"><img width="60" src="'+t.images[o]+'?imageMogr2/thumbnail/60"/></a>'):n||$(a).removeClass("on").html('<img width="60" src="//lc-joabcrtt.cn-n1.lcfile.com/d4c225054f005a4d7d39.png?imageMogr2/thumbnail/60"/>')})}),$(".product-order-list").on("click",".update-stock",function(){var t=$(this);if(t.data("state"))return!1;t.data("state",!0);var e=t.find(".am-icon").hasClass("on"),a=t.attr("product-id"),n=t.attr("order-id");$.ajax({url:"/order/order/update-stock",data:{"is-set":e,"product-id":a,"order-id":n},success:function(a){t.data("state",!1),a.success&&(e?t.find(".am-icon").removeClass("on").addClass("off"):t.find(".am-icon").removeClass("off").addClass("on"))}})});var l=$("#modal-set-stock"),p=l.find("input[name=stock]"),m=l.find("[name=sales]"),h=l.find(".stock-minus"),f=l.find(".stock-plus"),v=$(".stock-save"),g=$(".stock-reset"),k=$(".ckb-warning-stock-out"),y=$(".ckb-warning-stock-in"),b=0,x=l.find(".product-info");$(".product-order-list").on("click",".set-stock",function(){return l.modal({relatedTarget:this,onCancel:function(){return!1}}),!1}),l.on("open.modal.amui",function(e){var n=$(e.relatedTarget);n.addClass("current");var o=n.attr("product-id");v.attr("product-id",o),k.prop("checked",!1),y.prop("checked",!1),x.html(n.parent().find(".image").html()+" "+n.parent().find(".product-title").text()),$.ajax({type:"get",url:"/order/order/set-stock",data:{"product-id":o},success:function(e){return e.success?(p.val(e.stock),b=e.stock,p.attr("data-stock",e.stock),m.val(e.sales),m.attr("data-sales",e.sales),v.attr("product-id",o),e.updateStockDate>1?y.prop("checked",!0):0==e.updateStockDate&&k.prop("checked",!0),f.removeAttr("disabled").removeClass("am-btn-default").addClass("am-btn-primary"),h.removeAttr("disabled").removeClass("am-btn-default").addClass("am-btn-primary"),setTimeout(function(){p[0].focus(),p[0].select()},100),void(a&&t(n))):!1}})}),l.on("close.modal.amui",function(){if(p.val(0),p.attr("data-stock",0),m.val(0),m.attr("data-sales",0),v.removeAttr("product-id"),f.attr("disabled","disabled").addClass("am-btn-default").removeClass("am-btn-primary"),h.attr("disabled","disabled").addClass("am-btn-default").removeClass("am-btn-primary"),x.html(""),a){var t=$(".set-stock.current"),e=t.parents(".order-split").next(),n=t.parents(".product-order-list"),o=n.find(".btn-one-update-stock");if(e.hasClass("order-split")){var r=void 0;r=e.hasClass("is-parent-product")?e.next().find(".set-stock"):e.find(".set-stock"),setTimeout(function(){r.click()},2e3)}else a=!1,o.attr("disabled",!1),o.find("span").text("一键更新库存"),setTimeout(function(){var e=t.parents("tr").find(".ckb-shipped");e.prop("checked")||(e.click(),o.attr("disabled",!0))},2e3)}$(".set-stock.current").removeClass("current")}),h.click(function(){var t=parseInt(p.val()),e=parseInt(m.val());t>0&&(p.val(t-1),m.val(e+1)),p.trigger("change")}),f.click(function(){var t=parseInt(p.val());p.val(t+1),p.trigger("change")}),v.click(function(){var t,e=$(this);$("input[name='updateStockDate']:checked").each(function(){t=$(this).val()}),$.ajax({type:"post",url:"/order/order/set-stock",data:{"product-id":e.attr("product-id"),stock:p.val(),sales:m.val(),updateStockDate:t},success:function(t){if(t.success){var e=$(".set-stock.current").parents(".order-split").find(".update-stock");e.find(".am-icon").hasClass("off")&&e.trigger("click"),l.modal("close")}}})}),g.click(function(){p.find("option[value="+p.attr("stock")+"]")[0].selected=!0,m.val(m.attr("sales")),p.trigger("change")}),k.click(function(){y.prop("checked",!1)}),y.click(function(){k.prop("checked",!1)}),p.change(function(){var t=parseInt(p.val());t>0&&0==b?(y.prop("checked",!0),k.prop("checked",!1)):0==t?(k.prop("checked",!0),y.prop("checked",!1)):(y.prop("checked",!1),k.prop("checked",!1))}),$(".ckb-not-shipped").click(function(){$("#search-not-shipped").val(this.checked?"on":""),e()}),$(".select-shipping").change(function(){$("#search-shipping").val(this.value?this.value:""),e()}),$(".select-limit").change(function(){$("#limit").val(this.value?this.value:""),e()}),$(".ckb-shipped").click(function(){var t=$(this),e=$(this).attr("order-id"),a=this.checked;$.ajax({type:"post",url:"/order/order/shipping",data:{"order-id":e,shipping:a},success:function(e){e.success&&(t[0].checked?(t.parents("tr").removeClass("off"),setTimeout(function(){location.reload()},500)):t.parents("tr").addClass("off"))}})});var C=$(".action-shipping-company");C.popover({content:'<input class="shipping-company-input"/>'});var w=$(".shipping-company-input");C.each(function(t){$(this).on("open.popover.amui",function(){setTimeout(function(){return w.get(t).focus()},0)})}),w.each(function(t){var e=C.eq(t),a=e.data("order-id");$(this).change(function(){$.ajax({url:"/order/order/action-tracking-number",data:{orderId:a,trackingNumber:$(this).val()}}).then(function(t){if(t.success){e.removeClass("disabled"),e.off().attr("href","http://www.kuaidi100.com/auto.shtml?nu="+t.trackingNumber),e.popover("close");var a=e.parent().find(".clipboard-tracking-number"),n=new Clipboard(a[0],{text:function(){return t.trackingNumber}});n.on("success",function(){a.addClass("active")})}})})}),$(".clipboard-tracking-number").each(function(){var t=this;if($(this).attr("data-clipboard-text")){var e=new Clipboard(this);e.on("success",function(){$(t).addClass("active")})}}),$(".clipboard-customer-name").each(function(){var t=this,e=new Clipboard(this);e.on("success",function(){$(t).addClass("am-btn-success")})}),$(".clipboard-customer-address").each(function(){var t=this,e=new Clipboard(this);e.on("success",function(){$(t).addClass("active")})});var I=$("#modal-track-order"),T=I.find(".am-modal-hd"),j=I.find(".am-modal-bd");$(".track-order").click(function(){return T.find("span").text($(this).data("track")),j.html("<ul></ul>"),$.ajax($(this).attr("href")).then(function(t){if(t.list){var e="";$.each(t.list,function(t,a){e+='<li class="'+(0===t?"success":"")+'">'+a.status+" "+a.time+"</li>"}),j.find("ul").append(e)}else j.find("ul").append("<li>暂无发货记录,请稍后查看</li>");I.modal()}),!1});var A=$(".ckb-show-main-shop-order"),S=$(".ckb-show-new-shop-order");$.cookie("show-main-shop-order")&&(A.prop("checked",!0),$(".new-shop-order").addClass("hide")),A.click(function(){this.checked?($.cookie("show-main-shop-order","true",{expires:new Date((new Date).getTime()+31536e6),path:"/",domain:location.host}),$(".new-shop-order").addClass("hide"),S.prop("checked")&&S.click()):($.cookie("show-main-shop-order","",{expires:new Date((new Date).getTime()),path:"/",domain:location.host}),$(".new-shop-order").removeClass("hide"))});var O=$(".ckb-show-main-shop-order"),D=$(".ckb-show-new-shop-order");$.cookie("show-new-shop-order")&&(D.prop("checked",!0),$(".main-shop-order").addClass("hide")),D.click(function(){this.checked?($.cookie("show-new-shop-order","true",{expires:new Date((new Date).getTime()+31536e6),path:"/",domain:location.host}),$(".main-shop-order").addClass("hide"),O.prop("checked")&&O.click()):($.cookie("show-new-shop-order","",{expires:new Date((new Date).getTime()),path:"/",domain:location.host}),$(".main-shop-order").removeClass("hide"))});var M=$(".show-not-ship-count"),q=(new Date).getTime(),F=new Date(q-2592e5),U=new Date(q-864e5),L=U.getFullYear()+"-"+(U.getMonth()+1)+"-"+U.getDate(),N=F.getFullYear()+"-"+(F.getMonth()+1)+"-"+F.getDate();$.ajax({url:"/order/order/get-shipping-status-count?preDate="+L,success:function(t){0===t.mainShopCount&&M.find(".main-shop-day-1").addClass("on"),0===t.subShopCount&&M.find(".sub-shop-day-1").addClass("on"),M.find(".main-shop-day-1").text(t.mainShopCount),M.find(".sub-shop-day-1").text(t.subShopCount)}}),$.ajax({url:"/order/order/get-shipping-status-count?preDate="+N,success:function(t){0===t.mainShopCount&&M.find(".main-shop-day-3").addClass("on"),0===t.subShopCount&&M.find(".sub-shop-day-3").addClass("on"),M.find(".main-shop-day-3").text(t.mainShopCount),M.find(".sub-shop-day-3").text(t.subShopCount)}}),$(".product-order-list").each(function(){var t=$(this),e=t.find(".btn-one-update-stock"),a=!1,n=$(this),o=n.find(".product-number"),r=0;n.find(".product-count").each(function(t,e){r+=parseInt($(e).text())}),n.find(".order-split").each(function(n,i){var c=$(i).data("id"),s=parseInt($(i).find(".product-count").text());r>1&&o.html('<strong class="font-red">[共'+r+"件]</strong>"),$.ajax({type:"get",url:"/order/order/get-stock",data:{"product-id":c},success:function(n){$(i).attr("data-stock",n.stock);var o=$(i).find(".product-title"),r=o.html(),c="";n.comment&&(c=' <span style="color:#333">[注:'+n.comment.trim()+"]</span>"),r+=" {库:"+n.stock+"}"+c,o.html(r);var d=parseInt($(i).find(".product-count").text());d>n.stock&&$(i).find(".product-title").addClass("out-stock"),n.bindingId&&(a=!0,$(i).addClass("is-parent-product"),$(i).find(".update-stock").detach(),$(i).find(".set-stock").detach(),$.ajax({type:"get",url:"/order/order/get-binding-product",data:{"product-id":n.bindingId},success:function(a){var o=[];for(var r in a.mainImage)o.push(a.mainImage[r].url.replace("ac-JoaBcRTt.clouddn.com","image.wish698.cn").replace("lc-QuiPuWpJ.cn-n1.lcfile.com","image.wish698.cn"));var c="";n.bindingNumber*s>a.stock&&(c="out-stock");var d="off";t.find(".ckb-shipped").prop("checked")&&(d="on"),$(i).after('\n                                    \n                                    <div class="order-split child" data-id="'+n.bindingId+'" data-stock="'+a.stock+'" data-count="'+n.bindingNumber*s+'">\n                                    \n                                        <span class="image loading-elem" data-id="'+n.bindingId+'"><a href="'+o[0]+'" target="_blank"><img width="48" src="'+o[0]+'"></a></span>\n\n                                        <a class="product-title '+c+'" href="/order/order/edit/'+$(i).parents("tr").data("order-id")+'"><span class="product-count"><strong class="font-red product-count">'+n.bindingNumber*s+"</strong></span>*"+a.name+" {id:"+n.bindingId+"} {库:"+a.stock+'}</a>\n \n                                        <a class="set-stock" product-count="'+n.bindingNumber*s+'" product-id="'+n.bindingId+'" title="设置库存" href="javascript:;"><i class="am-icon am-icon-inbox"></i></a>\n                                        <a class="update-stock" order-id="'+$(i).parents("tr").data("order-id")+'" product-id="'+n.bindingId+'" title="是否已设置库存" href="javascript:;"><i class="am-icon am-icon-check-circle '+d+'"></i></a>\n                        \n                    </div>\n                                    \n                                    '),e.prop("disabled")&&!t.find(".ckb-shipped").prop("checked")&&e.removeAttr("disabled")}})),e.prop("disabled")&&!t.find(".ckb-shipped").prop("checked")&&a===!1&&e.removeAttr("disabled")}})})}),$(".clipboard-customer-address").each(function(t,e){var a=$(e).attr("title"),n="";/[^\，]+/.test(a)&&(n+=/([^\，]+)/.exec(a)[1]),/[\u4E00-\u9FA5]+省/.test(a)&&(n+=" , "+/([\u4E00-\u9FA5]+省)/.exec(a)[1]),/[\u4E00-\u9FA5]+自治区/.test(a)&&(n+=" , "+/([\u4E00-\u9FA5]+自治区)/.exec(a)[1]),/[\u4E00-\u9FA5]+市/.test(a)&&(n+=" "+/([\u4E00-\u9FA5]+市)/.exec(a)[1]),$(e).prev().html(n)})},addFun:function(){$("#form-add-order").validate({submitHandler:function(t){$("#shipping-address").val().indexOf("新疆")>0&&alert("收货地址含有新疆省！"),$("#shipping-address").val().indexOf("西藏")>0&&alert("收货地址含有西藏省！"),t.submit()}}),this.customerNameTypeAhead(),this.orderTypeAheadAdd(),this.domUpdate(),this.orderBatchAdd(),-1!==location.search.indexOf("name")?(this.copyNewOrder(),this.orderNameTypeAhead()):(this.orderNameTypeAhead(),$("input[name]").get(0).focus()),location.search.indexOf("is-new-shop")>-1&&$(".is-new-shop").prop("checked",!0)},copyNewOrder:function(){var t=location.search,e=/name=([^\&]*)\&/.exec(t)[1],a=/tracking-number=(\d+)/.test(t);e=e.split(","),$("input[name=name]").eq(0).val(decodeURIComponent(e[0])),a&&$("#tracking-number").val(/tracking-number=(\d+)/.exec(t)[1])},editFun:function(){$("#form-edit-order").validate({submitHandler:function(t){$("#shipping-address").val().indexOf("新疆")>0&&alert("收货地址含有新疆省！"),$("#shipping-address").val().indexOf("西藏")>0&&alert("收货地址含有西藏省！"),t.submit()}}),this.customerNameTypeAhead(),this.orderTypeAheadUpdate(),this.domUpdate(),this.orderNameTypeAhead(),this.orderBatchAdd(),this.clipboard()},domUpdate:function(){var t=this,e=($("#shipping-company"),$("#tracking-number"),$(".content-name-group")),a='\n                    <div class="list-group-field am-form-group">\n                        <div class="am-u-sm-8">\n                            <input class="name" name="name" type="text" placeholder="输入订单内容" autocomplete="off">\n                        </div>\n                        <div class="am-u-sm-1">\n                            <select name="shipping-count">\n                                <option value="1">1</option>\n                                <option value="2">2</option>\n                                <option value="3">3</option>\n                                <option value="4">4</option>\n                                <option value="5">5</option>\n                                <option value="6">6</option>\n                                <option value="7">7</option>\n                                <option value="8">8</option>\n                                <option value="9">9</option>\n                                <option value="10">10</option>\n                                <option value="11">11</option>\n                                <option value="12">12</option>\n                                <option value="13">13</option>\n                                <option value="14">14</option>\n                                <option value="15">15</option>\n                                <option value="16">16</option>\n                                <option value="17">17</option>\n                                <option value="18">18</option>\n                                <option value="19">19</option>\n                                <option value="20">20</option>\n                                <option value="21">21</option>\n                                <option value="22">22</option>\n                                <option value="23">23</option>\n                                <option value="24">24</option>\n                                <option value="25">25</option>\n                                <option value="26">26</option>\n                                <option value="27">27</option>\n                                <option value="28">28</option>\n                                <option value="29">29</option>\n                                <option value="30">30</option>\n                                <option value="31">31</option>\n                                <option value="32">32</option>\n                                <option value="33">33</option>\n                                <option value="34">34</option>\n                                <option value="35">35</option>\n                                <option value="36">36</option>\n                                <option value="37">37</option>\n                                <option value="38">38</option>\n                                <option value="39">39</option>\n                                <option value="40">40</option>\n                                <option value="41">41</option>\n                                <option value="42">42</option>\n                                <option value="43">43</option>\n                                <option value="44">44</option>\n                                <option value="45">45</option>\n                            </select>\n                        </div>\n                        <label class="am-u-sm-3 am-form-label">\n                            <input type="hidden" name="is-gift" class="is-gift">\n                            <input type="hidden" name="is-shipping" class="is-shipping">\n                            <label><input class="ckb-is-gift" type="checkbox"> 赠品</label>\n                            <span class="split"></span>\n                            <label><input class="ckb-is-shipping" type="checkbox"> 已发货</label>\n                            <span class="split"></span>\n                            <a href="javascript:;" class="remove">删除</a>\n                        </label>\n                    </div>\n            ';$(".order-add").click(function(){var n=$(a);e.append(n),t.bindOrderNameTypeAhead(n.find(".name")),n.find("input[name=name]").get(0).focus()}),e.on("click",".remove",function(){$(this).parents(".list-group-field").detach()});var n=$("#content-name");n.on("click",".ckb-is-shipping",function(){var t=$(this).parents(".list-group-field").index();this.checked?$(".is-shipping").eq(t).val(1):$(".is-shipping").eq(t).val(0)}),n.on("click",".ckb-is-gift",function(){var t=$(this).parents(".list-group-field").index();this.checked?$(".is-gift").eq(t).val(1):$(".is-gift").eq(t).val(0)});var o=$(".address-list"),r=$("#shipping-address");o.on("click",".remove-address",function(){var t=this,e=$(this).data("index");return 1===o.find(".remove-address").length?window.customerAddress=[]:window.customerAddress.splice(e,1),$.ajax({url:"/order/order/remove-customer-address",data:{customerId:$("#customer-name-id").val(),address:window.customerAddress},success:function(e){$(t).parents("li").detach(),r.val("").get(0).focus(),window.customerAddress=[],o.find("li").each(function(t,e){window.customerAddress.push($(e).find(".customer-address-list").text()),$(e).find(".remove-address").attr("data-index",t)})}}),!1})},orderTypeAheadAdd:function(){var t=$("#customer-name"),e=$("#customer-name-id"),a=$(".new-customer"),n=$("#shipping-address"),o=$(".address-list"),r=$(".new-address"),i=($(".check-customer-rename"),$(".check-customer-id")),c=$(".ckb-is-taobao-user");t.on({keyup:function(){this.value=$.trim(this.value),$(this).data("typeselect")||(a.prop("checked",!0),r.prop("checked",!0),o.empty())},focus:function(){$(this).data("typeselect",!1)},"typeahead:select":function(t,i){e.val(i.customerId);var s=i.address;window.customerAddress=i.address,o.empty(),c.prop("checked",i.isTaobaoUser),1===s.length&&(n.val(s[0]),r.prop("checked",!1));for(var d=0;d<=s.length-1;d++)o.append('<li><span class="customer-address-list">'+s[d]+'</span> <a class="use-address" href="javascript:;">[使用此地址'+(d===s.length-1?"-<strong>最新</strong>":"")+']</a> <span class="sp"></span> <a data-index="'+d+'" class="remove-address" href="javascript:;">[删除]</a></li>');a.prop("checked",!1),$(this).data("typeselect",!0)},"typeahead:asyncrequest":function(){i.addClass("on").html('<i class="am-icon-spinner am-icon-spin"></i> 淘宝昵称检测中，请稍后...')},"typeahead:asyncreceive":function(){e.parent().find(".tt-menu").hasClass("tt-empty")?i.html('<i class="am-icon-exclamation-circle"></i> 无查询结果，该名称为新用户'):i.removeClass("on").text("")}}),o.on("click",".use-address",function(){n.val($(this).parents("li").find("span").text()),o.empty(),r.prop("checked",!1)}),a.click(function(){this.checked&&(e.val(""),r.prop("checked",!1).click())}),r.click(function(){this.checked&&(n.val("").get(0).focus(),o.empty())}),n.on("change",function(){r.prop("checked",!0)})},orderTypeAheadUpdate:function(){var t=$("#customer-name"),e=$("#customer-name-id"),a=$("#shipping-address"),n=$(".address-list"),o=$(".check-customer-id"),r=$(".ckb-is-taobao-user");t.on({"typeahead:select":function(t,o){e.val(o.customerId),n.empty(),r.prop("checked",o.isTaobaoUser);var i=o.address;if(1===i.length)a.val(i[0]);else for(var c=i.length-1;c>=0;c--)n.append("<li><span>"+i[c]+'</span> <a href="javascript:;">使用此地址'+(c===i.length-1?"(最近更新)":"")+"</a> </li>")},"typeahead:asyncrequest":function(){
o.addClass("on").html('<i class="am-icon-spinner am-icon-spin"></i> 淘宝昵称检测中，请稍后...')},"typeahead:asyncreceive":function(){e.parent().find(".tt-menu").hasClass("tt-empty")?o.html('<i class="am-icon-exclamation-circle"></i> 无查询结果，该名称为新用户'):o.removeClass("on").text("")}}),n.on("click","a",function(){a.val($(this).parents("li").find("span").text()),n.empty()})},customerNameTypeAhead:function(){var t=$("#customer-name");t.typeahead(null,{display:function(t){return t.value},templates:{suggestion:function(t){return'<div><span class="tt-value">'+t.value+'</span><span class="tt-footer">'+(t.isTaobaoUser?"(淘宝用户)":" (非淘宝用户) ")+t.address+"</span></div>"}},highlight:!0,source:new n({datumTokenizer:n.tokenizers.obj.whitespace("value"),queryTokenizer:n.tokenizers.whitespace,remote:{url:"/order/order/add/search-customer",prepare:function(e,a){return a.data={name:$.trim(t.val())},a}}})})},orderNameTypeAhead:function(){var t=this;$(".name").each(function(e,a){t.bindOrderNameTypeAhead($(a))})},orderBatchAdd:function(){var t=$("#modal-order-batch-add"),e=$("#batch-text"),a=$("#batch-create"),n=$(".order-add");$(".order-batch-add").click(function(){t.modal(),e.val(""),e[0].focus()}),a.click(function(){var o=e.val();if(!$.trim(o)||o.indexOf("商家编码：")<0)return alert("请输入正确的淘宝订单内容!"),!1;if(/订单号/.test(o))for(var r=o.match(/订单号.+[^\n]/gi),i=0;i<r.length;i++)o=o.replace(/订单号.+[^\n]/gi,"");o=o.replace(/\n/gi,""),o=o.replace(/买家已付款[^、)]+\)/gi,""),o=o.replace(/卖家已发货[^、)]+\)/gi,"");var c=o.match(/商家编码：/gi).length,s=o.match(/商家编码：\d+/gi),d=o.match(/￥\d+\.\d+/gi);c!==s.length&&alert("注意：商家编码数据不匹配，请手动检测数据");var u=!0,l=function(){return 2===$(".name").length?0:(u=!1,$(".name").length)}();s=s.map(function(t,e){return n.click(),parseInt(t.replace("商家编码：",""))}),d=d.map(function(t,e){return t=t.replace(/￥\d+\.\d\d/,""),parseInt(t)});var p=$(".name");u||n.click(),$(".remove").last().click();var m=$("select[name=shipping-count]");return a.text("生成订单中..."),setTimeout(function(){$.each(s,function(e,n){$.ajax({url:"/order/order/product?name="+n,async:!1,success:function(n){p.eq(l+1).val(n[0].value),m.eq(l/2).find("option").eq(d[e]-1).selected(),l+=2,a.text("生成订单"),t.modal("close")}})})},0),!1})},bindOrderNameTypeAhead:function(t){t.typeahead(null,{display:function(t){return t.value},templates:{suggestion:function(t){return'<div><img src="'+t.image+'?imageMogr2/thumbnail/32" />'+t.value+"</div>"}},highlight:!0,source:new n({datumTokenizer:n.tokenizers.obj.whitespace("value"),queryTokenizer:n.tokenizers.whitespace,remote:{url:"/order/order/product",prepare:function(e,a){return a.data={name:t.val()},a}}})})},clientNameTypeAhead:function(){},clipboard:function(){var t=$("#shipping-address"),e=$(".copy-phone"),a=$(".copy-address"),n=$(".copy-thumb-address"),o=t.val(),r=/\d{11}/;r.test(o)&&e.val(r.exec(o)[0]);var i=t.val(),c=/\d{11}/;c.test(i)&&(i=$.trim(i.replace(/\d{11}/,""))),i=$.trim(i.replace(/(^,|，|\.|。|;|；)|(,|，|\.|。|;|；$)/g,"")),a.val(i);var s=t.val();/\d{11}/.test(s)&&(s=$.trim(s.replace(/\d{11}/,""))),/区/.test(s)&&(s=$.trim(s.replace(/([\s\S]*?区)/,""))),/街道/.test(s)&&(s=$.trim(s.replace(/([\s\S]*?街道)/,""))),s=$.trim(s.replace(/(^,|，|\.|。|;|；)|(,|，|\.|。|;|；$)/g,"")),n.val(s)},checkCustomerRename:function r(t,e){var r=$(".check-customer-rename").removeClass("error");return $.trim(e.value)?(r.addClass("on").html('<i class="am-icon-spinner am-icon-spin"></i> 非淘宝用户名检测中...'),void $.ajax({url:"/order/order/check-customer-rename",data:{name:t}}).then(function(t){t.customer?r.addClass("error").html('<i class="am-icon-exclamation-circle"></i> 检测出重命名!'):r.html('<i class="am-icon-check"></i> 未检测出重命名')})):(r.removeClass("on"),!1)}}},{"../common/utils":6,bloodhound:10,"jquery-validate":17}],"import-order":[function(t,e,a){"use strict";var n=(window.leanAppHeader,t("../common/utils"),t("async"));e.exports={indexFun:function(){var t=this,e=this;this.modalOrderSearch=$("#modal-order-search"),this.modalOrderSearchContent=this.modalOrderSearch.find(".am-table tbody"),this.countLen=this.modalOrderSearch.find(".count-len"),this.btnImportOrder=this.modalOrderSearch.find(".btn-import-order"),this.setWisdomOrderSite(),this.setLuckymojoOrderSite(),this.setProductOrderSite(),this.isImporting=!1,this.btnImportOrder.click(function(){var a=[];t.modalOrderSearchContent.find("tr").each(function(t,e){$(e).attr("data-product-id")&&a.push({productId:$(e).data("product-id"),reserve:$(e).data("reserve"),newReserve:$(e).data("count")})}),confirm("确定进行批量设置?")&&(e.isImporting=!0,$(e.btnImportOrder).attr("disabled","disabled"),n.forEachSeries(a,function(t,a){$.ajax({url:"/admin/import-order/save-data",type:"post",data:{productId:t.productId,reserve:t.reserve,newReserve:t.newReserve}}).then(function(){var n=e.modalOrderSearchContent.find("tr[data-product-id="+t.productId+"]");n.find(".import-check-true").removeClass("import-check-true").addClass("import-check-success"),n.find(".update-reserve").addClass("on"),a()})},function(t){return t?(alert(a),!1):void setTimeout(function(){e.isImporting=!1,alert("批量更新完成!")},1e3)}))}),this.modalOrderSearch.on("open.modal.amui",function(){$(e.btnImportOrder).attr("disabled","disabled")}),$(".btn-save-text").click(function(){var t=$(this).parents(".content"),e=$.trim(t.find("textarea").val());$.cookie(t.find("textarea").attr("class"),e,{expires:new Date((new Date).getTime()+2592e6),path:"/",domain:location.host}),setTimeout(function(){location.reload()},500)})},setWisdomOrderSite:function(){var t=this,e=$(".input-wisdom-order");$(".btn-import-wisdom-order").click(function(){if(t.isImporting)return alert("正在导入中，请稍后..."),!1;t.isImporting=!0,t.modalOrderSearch.modal(),t.modalOrderSearchContent.empty(),$(t.btnImportOrder).attr("disabled","disabled"),t.countLen.text("");var a=[],o=$.trim(e.val()).split("\n");$.each(o,function(t,e){e=e.replace(/\t/g," "),e=e.replace(/\s+/g," ");var n=/([^\$]+)\$/.exec(e)[1];n=n.replace(/\d\/\d.*/,""),n=$.trim(n),a.push({name:n,count:/\$[^\s]+\s(\d+)/.exec(e)[1]})});var r=0;t.countLen.text(r+"/"+a.length),n.forEachSeries(a,function(e,n){$.ajax({url:"/admin/import-order/data",type:"post",data:{"import-data":JSON.stringify([e])}}).then(function(e){r<a.length&&r++,r===a.length&&$(t.btnImportOrder).removeAttr("disabled"),t.appendData(e,r,a,n)})},function(e){t.isImporting=!1})}),$.cookie("input-wisdom-order")&&$(".input-wisdom-order").val($.cookie("input-wisdom-order"))},setLuckymojoOrderSite:function(){var t=this,e=$(".input-luckymojo-order");$(".btn-import-luckymojo-order").click(function(){if(t.isImporting)return alert("正在导入中，请稍后..."),!1;t.isImporting=!0,t.modalOrderSearch.modal(),t.modalOrderSearchContent.empty(),$(t.btnImportOrder).attr("disabled","disabled");var a=[],o=$.trim(e.val()).split("\n");$.each(o,function(t,e){e=e.replace(/\t/g," "),e=e.replace(/\s+/g," "),a.push({name:/(\w+\-\w+\-\w+)/.exec(e)[1],count:/(\d+)/.exec(e)[1]})});var r=0;t.countLen.text(r+"/"+a.length),n.forEachSeries(a,function(e,n){$.ajax({url:"/admin/import-order/data",type:"post",data:{"import-data":JSON.stringify([e])}}).then(function(e){r<a.length&&r++,r===a.length&&$(t.btnImportOrder).removeAttr("disabled"),t.appendData(e,r,a,n)})},function(e){t.isImporting=!1})}),$.cookie("input-luckymojo-order")&&$(".input-luckymojo-order").val($.cookie("input-luckymojo-order"))},setProductOrderSite:function(){var t=this,e=$(".input-product-order");$(".btn-import-product-order").click(function(){if(t.isImporting)return alert("正在导入中，请稍后..."),!1;t.isImporting=!0,t.modalOrderSearch.modal(),t.modalOrderSearchContent.empty(),$(t.btnImportOrder).attr("disabled","disabled");var a=[],o=$.trim(e.val()).split("\n");$.each(o,function(t,e){e=e.replace(/\t/g," "),e=e.replace(/\s+/g," "),e=e.toUpperCase(),a.push({name:$.trim(/([^\*]+)/.exec(e)[1]),count:/\*\s?(\d+)/.exec(e)[1]})});var r=0;t.countLen.text(r+"/"+a.length),n.forEachSeries(a,function(e,n){$.ajax({url:"/admin/import-order/data",type:"post",data:{"import-data":JSON.stringify([e])}}).then(function(e){r<a.length&&r++,r===a.length&&$(t.btnImportOrder).removeAttr("disabled"),t.appendData(e,r,a,n)})},function(e){t.isImporting=!1})}),$.cookie("input-product-order")&&$(".input-product-order").val($.cookie("input-product-order"))},appendData:function(t,e,a,n){var o=this;o.countLen.text(e+"/"+a.length);var r="//lc-JoaBcRTt.cn-n1.lcfile.com/d4c225054f005a4d7d39.png";for(var i in t.result[0].mainImage)t.result[0].mainImage[i].isMainImage&&(r=t.result[0].mainImage[i].url);var c=""===t.result[0].nameCn?"-":t.result[0].nameCn,s=""===t.result[0].stock?"-":t.result[0].stock,d=""===t.result[0].reserve?"-":t.result[0].reserve,u=t.result[0].isTrue?'<span class="import-check-true"><i class="am-icon-check"></i></span>':'<span class="import-check-false"><i class="am-icon-close"></i></span>';o.modalOrderSearchContent.append('<tr data-product-id="'+t.result[0].productId+'" data-reserve="'+d+'" data-count="'+t.result[0].count+'">\n                        <td class="t-c"><a target="_blank" href="'+r+'"><img src="'+r+'?imageMogr2/thumbnail/32" alt=""></a></td>\n                        <td>['+t.result[0].name+"]<br/>"+c+'</td>\n                        <td class="t-c">'+s+'</td>\n                        <td class="t-c">'+d+'</td>\n                        <td class="t-c"><strong>'+t.result[0].count+'</strong></td>\n                        <td class="t-c"><i class="update-reserve">'+("-"===d?"-":parseInt(d)+parseInt(t.result[0].count))+'</i></td>\n                        <td class="t-c">'+u+"</td>\n                    </tr>"),n()}}},{"../common/utils":6,async:1}],identity:[function(t,e,a){"use strict";t("jquery-validate"),t("jquery-form"),e.exports={indexFun:function(){$(".remove-identity").click(function(){var t=$(this);return $("#confirm-remove-identity").modal({relatedTarget:this,onConfirm:function(e){location.href=t.attr("href")},onCancel:function(){return!1}}),!1}),$(".search-isoften").change(function(){$("form").find(".am-btn").click()})},addFun:function(){$("#form-add-identity").validate()},editFun:function(){$("#form-edit-identity").validate()},uploadImg:function(t){var e=$("#form-upload-img"),a=$("#icon-image"),n=$(".upload-loading");e.submit(function(){return n.addClass("on"),$(this).ajaxSubmit({success:function(e){n.removeClass("on"),e.success&&window.parent[t](e.url)}}),!1}),a.change(function(){e.submit()})}}},{"jquery-form":13,"jquery-validate":17}],customer:[function(t,e,a){"use strict";t("jquery-validate");var n=t("bloodhound");e.exports={indexFun:function(){var t=$("#modal-alert");$(".remove-customer").click(function(){return $("#confirm-remove-customer").modal({relatedTarget:this,onConfirm:function(e){var a=this,n=$(this.relatedTarget);$.ajax({type:"post",url:"/order/customer/remove/"+n.data("id"),success:function(e){e.success?location.reload():t.modal({relatedTarget:a}).find(".am-modal-bd").html('无法删除,请先删除该用户所有<a href="/order/order?search-customer-id='+n.data("id")+'" target="_blank">发货订单</a>后再进行删除')}})},onCancel:function(){return!1}}),!1})},addFun:function(){this.addAddress(),this.customerTypeAhead()},editFun:function(){this.addAddress(),this.customerTypeAhead()},addAddress:function(){var t=$("#content-address"),e=$(".address-add"),a=t.find(".remove");e.click(function(){var t=$(".address-field:last"),e=t.clone(!0);e.insertAfter(t),e.find(".address").val("").get(0).focus()}),a.click(function(){return 1===t.find(".remove").length?!1:void $(this).parents(".address-field").detach()})},customerTypeAhead:function(){var t=$("#parent-customer"),e=$("#parent-customer-id"),a=new n({datumTokenizer:n.tokenizers.obj.whitespace("value"),queryTokenizer:n.tokenizers.whitespace,remote:{url:"/order/customer/add/customer-parent",prepare:function(e,a){return a.data={name:t.val()},a}}});t.typeahead(null,{display:"value",highlight:!0,source:a}),t.on({"typeahead:select":function(t,a){e.val(a.customerId)},blur:function(){""===$.trim(this.value)&&e.val("")}})}}},{bloodhound:10,"jquery-validate":17}],"article-category":[function(t,e,a){"use strict";window.leanAppHeader,t("../common/utils");e.exports={indexFun:function(){var t=$("#modal-alert");$(".remove-course").click(function(){return $("#confirm-remove-article-category").modal({relatedTarget:this,onConfirm:function(){var e=this,a=$(this.relatedTarget),n=a.attr("data-id");$.ajax({type:"post",url:"/admin/article-category/remove/"+n}).then(function(){t.modal({relatedTarget:e,onConfirm:function(){var t=$(e.relatedTarget);t.parents("tr").detach()}}).find(".am-modal-bd").text("删除文章分类成功!")})},onCancel:function(){return!1}}),!1})}}},{"../common/utils":6}],1:[function(t,e,a){(function(t,a){!function(){function n(){}function o(t){return t}function r(t){return!!t}function i(t){return!t}function c(t){return function(){if(null===t)throw new Error("Callback was already called.");t.apply(this,arguments),t=null}}function s(t){return function(){null!==t&&(t.apply(this,arguments),t=null)}}function d(t){return P(t)||"number"==typeof t.length&&t.length>=0&&t.length%1===0}function u(t,e){for(var a=-1,n=t.length;++a<n;)e(t[a],a,t)}function l(t,e){for(var a=-1,n=t.length,o=Array(n);++a<n;)o[a]=e(t[a],a,t);return o}function p(t){return l(Array(t),function(t,e){return e})}function m(t,e,a){return u(t,function(t,n,o){a=e(a,t,n,o)}),a}function h(t,e){u(H(t),function(a){e(t[a],a)})}function f(t,e){for(var a=0;a<t.length;a++)if(t[a]===e)return a;return-1}function v(t){var e,a,n=-1;return d(t)?(e=t.length,function(){return n++,e>n?n:null}):(a=H(t),e=a.length,function(){return n++,e>n?a[n]:null})}function $(t,e){return e=null==e?t.length-1:+e,function(){for(var a=Math.max(arguments.length-e,0),n=Array(a),o=0;a>o;o++)n[o]=arguments[o+e];switch(e){case 0:return t.call(this,n);case 1:return t.call(this,arguments[0],n)}}}function g(t){return function(e,a,n){return t(e,n)}}function k(t){return function(e,a,o){o=s(o||n),e=e||[];var r=v(e);if(0>=t)return o(null);var i=!1,d=0,u=!1;!function l(){if(i&&0>=d)return o(null);for(;t>d&&!u;){var n=r();if(null===n)return i=!0,void(0>=d&&o(null));d+=1,a(e[n],n,c(function(t){d-=1,t?(o(t),u=!0):l()}))}}()}}function y(t){return function(e,a,n){return t(L.eachOf,e,a,n)}}function b(t){return function(e,a,n,o){return t(k(a),e,n,o)}}function x(t){return function(e,a,n){return t(L.eachOfSeries,e,a,n)}}function C(t,e,a,o){o=s(o||n),e=e||[];var r=d(e)?[]:{};t(e,function(t,e,n){a(t,function(t,a){r[e]=a,n(t)})},function(t){o(t,r)})}function w(t,e,a,n){var o=[];t(e,function(t,e,n){a(t,function(a){a&&o.push({index:e,value:t}),n()})},function(){n(l(o.sort(function(t,e){return t.index-e.index}),function(t){return t.value}))})}function I(t,e,a,n){w(t,e,function(t,e){a(t,function(t){e(!t)})},n)}function T(t,e,a){return function(n,o,r,i){function c(){i&&i(a(!1,void 0))}function s(t,n,o){return i?void r(t,function(n){i&&e(n)&&(i(a(!0,t)),i=r=!1),o()}):o()}arguments.length>3?t(n,o,s,c):(i=r,r=o,t(n,s,c))}}function j(t,e){return e}function A(t,e,a){a=a||n;var o=d(e)?[]:{};t(e,function(t,e,a){t($(function(t,n){n.length<=1&&(n=n[0]),o[e]=n,a(t)}))},function(t){a(t,o)})}function S(t,e,a,n){var o=[];t(e,function(t,e,n){a(t,function(t,e){o=o.concat(e||[]),n(t)})},function(t){n(t,o)})}function O(t,e,a){function o(t,e,a,o){if(null!=o&&"function"!=typeof o)throw new Error("task callback must be a function");return t.started=!0,P(e)||(e=[e]),0===e.length&&t.idle()?L.setImmediate(function(){t.drain()}):(u(e,function(e){var r={data:e,callback:o||n};a?t.tasks.unshift(r):t.tasks.push(r),t.tasks.length===t.concurrency&&t.saturated()}),void L.setImmediate(t.process))}function r(t,e){return function(){i-=1;var a=!1,n=arguments;u(e,function(t){u(s,function(e,n){e!==t||a||(s.splice(n,1),a=!0)}),t.callback.apply(t,n)}),t.tasks.length+i===0&&t.drain(),t.process()}}if(null==e)e=1;else if(0===e)throw new Error("Concurrency must not be zero");var i=0,s=[],d={tasks:[],concurrency:e,payload:a,saturated:n,empty:n,drain:n,started:!1,paused:!1,push:function(t,e){o(d,t,!1,e)},kill:function(){d.drain=n,d.tasks=[]},unshift:function(t,e){o(d,t,!0,e)},process:function(){for(;!d.paused&&i<d.concurrency&&d.tasks.length;){var e=d.payload?d.tasks.splice(0,d.payload):d.tasks.splice(0,d.tasks.length),a=l(e,function(t){return t.data});0===d.tasks.length&&d.empty(),i+=1,s.push(e[0]);var n=c(r(d,e));t(a,n)}},length:function(){return d.tasks.length},running:function(){return i},workersList:function(){return s},idle:function(){return d.tasks.length+i===0},pause:function(){d.paused=!0},resume:function(){if(d.paused!==!1){d.paused=!1;for(var t=Math.min(d.concurrency,d.tasks.length),e=1;t>=e;e++)L.setImmediate(d.process)}}};return d}function D(t){return $(function(e,a){e.apply(null,a.concat([$(function(e,a){"object"==typeof console&&(e?console.error&&console.error(e):console[t]&&u(a,function(e){console[t](e)}))})]))})}function M(t){return function(e,a,n){t(p(e),a,n)}}function q(t){return $(function(e,a){var n=$(function(a){var n=this,o=a.pop();return t(e,function(t,e,o){t.apply(n,a.concat([o]))},o)});return a.length?n.apply(this,a):n})}function F(t){return $(function(e){var a=e.pop();e.push(function(){var t=arguments;n?L.setImmediate(function(){a.apply(null,t)}):a.apply(null,t)});var n=!0;t.apply(this,e),n=!1})}var U,L={},N="object"==typeof self&&self.self===self&&self||"object"==typeof a&&a.global===a&&a||this;null!=N&&(U=N.async),L.noConflict=function(){return N.async=U,L};var E=Object.prototype.toString,P=Array.isArray||function(t){return"[object Array]"===E.call(t)},z=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},H=Object.keys||function(t){var e=[];for(var a in t)t.hasOwnProperty(a)&&e.push(a);return e},_="function"==typeof setImmediate&&setImmediate,B=_?function(t){_(t)}:function(t){setTimeout(t,0)};"object"==typeof t&&"function"==typeof t.nextTick?L.nextTick=t.nextTick:L.nextTick=B,L.setImmediate=_?B:L.nextTick,L.forEach=L.each=function(t,e,a){return L.eachOf(t,g(e),a)},L.forEachSeries=L.eachSeries=function(t,e,a){return L.eachOfSeries(t,g(e),a)},L.forEachLimit=L.eachLimit=function(t,e,a,n){return k(e)(t,g(a),n)},L.forEachOf=L.eachOf=function(t,e,a){function o(t){d--,t?a(t):null===r&&0>=d&&a(null)}a=s(a||n),t=t||[];for(var r,i=v(t),d=0;null!=(r=i());)d+=1,e(t[r],r,c(o));0===d&&a(null)},L.forEachOfSeries=L.eachOfSeries=function(t,e,a){function o(){var n=!0;return null===i?a(null):(e(t[i],i,c(function(t){if(t)a(t);else{if(i=r(),null===i)return a(null);n?L.setImmediate(o):o()}})),void(n=!1))}a=s(a||n),t=t||[];var r=v(t),i=r();o()},L.forEachOfLimit=L.eachOfLimit=function(t,e,a,n){k(e)(t,a,n)},L.map=y(C),L.mapSeries=x(C),L.mapLimit=b(C),L.inject=L.foldl=L.reduce=function(t,e,a,n){L.eachOfSeries(t,function(t,n,o){a(e,t,function(t,a){e=a,o(t)})},function(t){n(t,e)})},L.foldr=L.reduceRight=function(t,e,a,n){var r=l(t,o).reverse();L.reduce(r,e,a,n)},L.transform=function(t,e,a,n){3===arguments.length&&(n=a,a=e,e=P(t)?[]:{}),L.eachOf(t,function(t,n,o){a(e,t,n,o)},function(t){n(t,e)})},L.select=L.filter=y(w),L.selectLimit=L.filterLimit=b(w),L.selectSeries=L.filterSeries=x(w),L.reject=y(I),L.rejectLimit=b(I),L.rejectSeries=x(I),L.any=L.some=T(L.eachOf,r,o),L.someLimit=T(L.eachOfLimit,r,o),L.all=L.every=T(L.eachOf,i,i),L.everyLimit=T(L.eachOfLimit,i,i),L.detect=T(L.eachOf,o,j),L.detectSeries=T(L.eachOfSeries,o,j),L.detectLimit=T(L.eachOfLimit,o,j),L.sortBy=function(t,e,a){function n(t,e){var a=t.criteria,n=e.criteria;return n>a?-1:a>n?1:0}L.map(t,function(t,a){e(t,function(e,n){e?a(e):a(null,{value:t,criteria:n})})},function(t,e){return t?a(t):void a(null,l(e.sort(n),function(t){return t.value}))})},L.auto=function(t,e,a){function o(t){g.unshift(t)}function r(t){var e=f(g,t);e>=0&&g.splice(e,1)}function i(){d--,u(g.slice(0),function(t){t()})}"function"==typeof arguments[1]&&(a=e,e=null),a=s(a||n);var c=H(t),d=c.length;if(!d)return a(null);e||(e=d);var l={},p=0,v=!1,g=[];o(function(){d||a(null,l)}),u(c,function(n){function c(){return e>p&&m(k,function(t,e){return t&&l.hasOwnProperty(e)},!0)&&!l.hasOwnProperty(n)}function s(){c()&&(p++,r(s),u[u.length-1](g,l))}if(!v){for(var d,u=P(t[n])?t[n]:[t[n]],g=$(function(t,e){if(p--,e.length<=1&&(e=e[0]),t){var o={};h(l,function(t,e){o[e]=t}),o[n]=e,v=!0,a(t,o)}else l[n]=e,L.setImmediate(i)}),k=u.slice(0,u.length-1),y=k.length;y--;){if(!(d=t[k[y]]))throw new Error("Has nonexistent dependency in "+k.join(", "));if(P(d)&&f(d,n)>=0)throw new Error("Has cyclic dependencies")}c()?(p++,u[u.length-1](g,l)):o(s)}})},L.retry=function(t,e,a){function n(t,e){if("number"==typeof e)t.times=parseInt(e,10)||r;else{if("object"!=typeof e)throw new Error("Unsupported argument type for 'times': "+typeof e);t.times=parseInt(e.times,10)||r,t.interval=parseInt(e.interval,10)||i}}function o(t,e){function a(t,a){return function(n){t(function(t,e){n(!t||a,{err:t,result:e})},e)}}function n(t){return function(e){setTimeout(function(){e(null)},t)}}for(;s.times;){var o=!(s.times-=1);c.push(a(s.task,o)),!o&&s.interval>0&&c.push(n(s.interval))}L.series(c,function(e,a){a=a[a.length-1],(t||s.callback)(a.err,a.result)})}var r=5,i=0,c=[],s={times:r,interval:i},d=arguments.length;if(1>d||d>3)throw new Error("Invalid arguments - must be either (task), (task, callback), (times, task) or (times, task, callback)");return 2>=d&&"function"==typeof t&&(a=e,e=t),"function"!=typeof t&&n(s,t),s.callback=a,s.task=e,s.callback?o():o},L.waterfall=function(t,e){function a(t){return $(function(n,o){if(n)e.apply(null,[n].concat(o));else{var r=t.next();r?o.push(a(r)):o.push(e),F(t).apply(null,o)}})}if(e=s(e||n),!P(t)){var o=new Error("First argument to waterfall must be an array of functions");return e(o)}return t.length?void a(L.iterator(t))():e()},L.parallel=function(t,e){A(L.eachOf,t,e)},L.parallelLimit=function(t,e,a){A(k(e),t,a)},L.series=function(t,e){A(L.eachOfSeries,t,e)},L.iterator=function(t){function e(a){function n(){return t.length&&t[a].apply(null,arguments),n.next()}return n.next=function(){return a<t.length-1?e(a+1):null},n}return e(0)},L.apply=$(function(t,e){return $(function(a){return t.apply(null,e.concat(a))})}),L.concat=y(S),L.concatSeries=x(S),L.whilst=function(t,e,a){if(a=a||n,t()){var o=$(function(n,r){n?a(n):t.apply(this,r)?e(o):a.apply(null,[null].concat(r))});e(o)}else a(null)},L.doWhilst=function(t,e,a){var n=0;return L.whilst(function(){return++n<=1||e.apply(this,arguments)},t,a)},L.until=function(t,e,a){return L.whilst(function(){return!t.apply(this,arguments)},e,a)},L.doUntil=function(t,e,a){return L.doWhilst(t,function(){return!e.apply(this,arguments)},a)},L.during=function(t,e,a){a=a||n;var o=$(function(e,n){e?a(e):(n.push(r),t.apply(this,n))}),r=function(t,n){t?a(t):n?e(o):a(null)};t(r)},L.doDuring=function(t,e,a){var n=0;L.during(function(t){n++<1?t(null,!0):e.apply(this,arguments)},t,a)},L.queue=function(t,e){var a=O(function(e,a){t(e[0],a)},e,1);return a},L.priorityQueue=function(t,e){function a(t,e){return t.priority-e.priority}function o(t,e,a){for(var n=-1,o=t.length-1;o>n;){var r=n+(o-n+1>>>1);a(e,t[r])>=0?n=r:o=r-1}return n}function r(t,e,r,i){if(null!=i&&"function"!=typeof i)throw new Error("task callback must be a function");return t.started=!0,P(e)||(e=[e]),0===e.length?L.setImmediate(function(){t.drain()}):void u(e,function(e){var c={data:e,priority:r,callback:"function"==typeof i?i:n};t.tasks.splice(o(t.tasks,c,a)+1,0,c),t.tasks.length===t.concurrency&&t.saturated(),L.setImmediate(t.process)})}var i=L.queue(t,e);return i.push=function(t,e,a){r(i,t,e,a)},delete i.unshift,i},L.cargo=function(t,e){return O(t,1,e)},L.log=D("log"),L.dir=D("dir"),L.memoize=function(t,e){var a={},n={},r=Object.prototype.hasOwnProperty;e=e||o;var i=$(function(o){var i=o.pop(),c=e.apply(null,o);r.call(a,c)?L.setImmediate(function(){i.apply(null,a[c])}):r.call(n,c)?n[c].push(i):(n[c]=[i],t.apply(null,o.concat([$(function(t){a[c]=t;var e=n[c];delete n[c];for(var o=0,r=e.length;r>o;o++)e[o].apply(null,t)})])))});return i.memo=a,i.unmemoized=t,i},L.unmemoize=function(t){return function(){return(t.unmemoized||t).apply(null,arguments)}},L.times=M(L.map),L.timesSeries=M(L.mapSeries),L.timesLimit=function(t,e,a,n){return L.mapLimit(p(t),e,a,n)},L.seq=function(){var t=arguments;return $(function(e){var a=this,o=e[e.length-1];"function"==typeof o?e.pop():o=n,L.reduce(t,e,function(t,e,n){e.apply(a,t.concat([$(function(t,e){n(t,e)})]))},function(t,e){o.apply(a,[t].concat(e))})})},L.compose=function(){return L.seq.apply(null,Array.prototype.reverse.call(arguments))},L.applyEach=q(L.eachOf),L.applyEachSeries=q(L.eachOfSeries),L.forever=function(t,e){function a(t){return t?o(t):void r(a)}var o=c(e||n),r=F(t);a()},L.ensureAsync=F,L.constant=$(function(t){var e=[null].concat(t);return function(t){return t.apply(this,e)}}),L.wrapSync=L.asyncify=function(t){return $(function(e){var a,n=e.pop();try{a=t.apply(this,e)}catch(o){return n(o)}z(a)&&"function"==typeof a.then?a.then(function(t){n(null,t)})["catch"](function(t){n(t.message?t:new Error(t))}):n(null,a)})},"object"==typeof e&&e.exports?e.exports=L:"function"==typeof define&&define.amd?define([],function(){return L}):N.async=L}()}).call(this,t("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:2}],2:[function(t,e,a){function n(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function r(t){if(l===setTimeout)return setTimeout(t,0);if((l===n||!l)&&setTimeout)return l=setTimeout,setTimeout(t,0);try{return l(t,0)}catch(e){try{return l.call(null,t,0)}catch(e){return l.call(this,t,0)}}}function i(t){if(p===clearTimeout)return clearTimeout(t);if((p===o||!p)&&clearTimeout)return p=clearTimeout,clearTimeout(t);try{return p(t)}catch(e){try{return p.call(null,t)}catch(e){return p.call(this,t)}}}function c(){v&&h&&(v=!1,h.length?f=h.concat(f):$=-1,f.length&&s())}function s(){if(!v){var t=r(c);v=!0;for(var e=f.length;e;){for(h=f,f=[];++$<e;)h&&h[$].run();$=-1,e=f.length}h=null,v=!1,i(t)}}function d(t,e){this.fun=t,this.array=e}function u(){}var l,p,m=e.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:n}catch(t){l=n}try{p="function"==typeof clearTimeout?clearTimeout:o}catch(t){p=o}}();var h,f=[],v=!1,$=-1;m.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var a=1;a<arguments.length;a++)e[a-1]=arguments[a];f.push(new d(t,e)),1!==f.length||v||r(s)},d.prototype.run=function(){this.fun.apply(null,this.array)},m.title="browser",m.browser=!0,m.env={},m.argv=[],m.version="",m.versions={},m.on=u,m.addListener=u,m.once=u,m.off=u,m.removeListener=u,m.removeAllListeners=u,m.emit=u,m.prependListener=u,m.prependOnceListener=u,m.listeners=function(t){return[]},m.binding=function(t){throw new Error("process.binding is not supported")},m.cwd=function(){return"/"},m.chdir=function(t){throw new Error("process.chdir is not supported")},m.umask=function(){return 0}},{}]},{},[7]);