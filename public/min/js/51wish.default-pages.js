require=function t(a,e,r){function o(i,d){if(!e[i]){if(!a[i]){var c="function"==typeof require&&require;if(!d&&c)return c(i,!0);if(n)return n(i,!0);var s=new Error("Cannot find module '"+i+"'");throw s.code="MODULE_NOT_FOUND",s}var u=e[i]={exports:{}};a[i][0].call(u.exports,function(t){var e=a[i][1][t];return o(e?e:t)},u,u.exports,t,a,e,r)}return e[i].exports}for(var n="function"==typeof require&&require,i=0;i<r.length;i++)o(r[i]);return o}({4:[function(t,a,e){"use strict";t("../../../../js/main"),t("./product"),t("./product-category")},{"../../../../js/main":12,"./product":"product","./product-category":"product-category"}],"product-category":[function(t,a,e){"use strict";var r=window.leanAppHeader;a.exports={indexFun:function(){this.container=$(".am-accordion"),this.addCategory1(),this.editCategory1(),this.removeCategory1(),this.moveCategory1Up(),this.moveCategory1Down(),this.addCategory2(),this.editCategory2(),this.removeCategory2(),this.moveCategory2Up(),this.moveCategory2Down()},addCategory1:function(){var t=$("#modal-category-1-add"),a=$("#input-category-1-add"),e=$("#modal-category-1-confirm-add");$(".btn-category-1-add").click(function(){a.val(""),t.modal({relatedTarget:this})}),e.click(function(){return e.data("state")?!1:($.AMUI.progress.start(),e.data("state",!0),$.post({url:leanApp.api+"classes/ProductCategory1",headers:r,data:JSON.stringify({index:$(".am-accordion-item").length,name:$.trim(a.val())?$.trim(a.val()):"无分类名"}),success:function(){$.AMUI.progress.done(),e.data("state",!1),t.modal("close"),location.reload()}}),!1)})},editCategory1:function(){var t=$("#modal-category-1-edit"),a=$("#input-category-1-edit"),e=$("#modal-category-1-confirm-edit"),o=$("#modal-alert"),n=null;$(".edit-category-1").each(function(){$(this).click(function(){var e=$(this).parents(".am-accordion-title").find("strong").text();return a.val($.trim(e)),t.modal({relatedTarget:this}),n=$(this).parents(".am-accordion-item").attr("data-id"),!1})}),e.click(function(){return e.data("state")?!1:($.AMUI.progress.start(),e.data("state",!0),$.get({url:leanApp.api+"classes/ProductCategory1",headers:r,data:'where={"category1Id":'+n+"}"}).done(function(t){return $.ajax({type:"PUT",url:leanApp.api+"classes/ProductCategory1/"+t.results[0].objectId,headers:r,data:JSON.stringify({name:$.trim(a.val())})})}).done(function(){e.data("state",!1),$.AMUI.progress.done(),t.modal("close"),o.modal({onConfirm:function(){return location.reload()}}).find(".am-modal-bd").text("编辑一级分类成功!")}),!1)})},removeCategory1:function(){var t=$(".remove-category-1"),a=$("#modal-category-1-remove"),e=$("#modal-alert");t.each(function(t,r){$(r).click(function(){return a.modal({relatedTarget:this,onConfirm:function(){return $(r).data("state")?!1:($(r).data("state",!0),$.AMUI.progress.start(),$.get({url:"/admin/product-category/remove-category-1",data:{id:$(r).parents(".am-accordion-item").attr("data-id")},success:function(){$(r).data("state",!1),$.AMUI.progress.done(),a.modal("close"),e.modal({onConfirm:function(){return location.reload()}}).find(".am-modal-bd").text("删除一级分类成功!")}}),!1)}}),!1})})},moveCategory1Up:function(){$(".moveup-category-1").each(function(){$(this).click(function(){var t=$(this),a=t.parents(".am-accordion-item"),e=a.prev(),r=a.attr("data-id"),o=e.attr("data-id"),n=a.index();return 0===n?!1:t.data("state")?!1:(t.data("state",!0),$.AMUI.progress.start(),$.get({url:"/admin/product-category/move-category-1-up",data:{currentId:r,targetId:o}}).done(function(r){r.success&&(a.after(e),t.data("state",!1),$.AMUI.progress.done())}),!1)})})},moveCategory1Down:function(){var t=$(".am-accordion-item");$(".movedown-category-1").each(function(){$(this).click(function(){var a=$(this),e=a.parents(".am-accordion-item"),r=e.next(),o=e.attr("data-id"),n=r.attr("data-id"),i=e.index();return i===t.length-1?!1:a.data("state")?!1:(a.data("state",!0),$.AMUI.progress.start(),$.get({url:"/admin/product-category/move-category-1-down",data:{currentId:o,targetId:n}}).done(function(t){t.success&&(e.before(r),a.data("state",!1),$.AMUI.progress.done())}),!1)})})},addCategory2:function(){var t=$("#modal-category-2-add"),a=$("#input-category-2-add"),e=$("#modal-category-2-confirm-add"),r=null,o=null;$(".btn-category-2-add").each(function(e,n){$(n).click(function(){r=$(this).parents(".am-accordion-item"),o=parseInt(r.attr("data-id")),a.val(""),t.modal({relatedTarget:this})})}),e.click(function(){if(e.data("state"))return!1;$.AMUI.progress.start(),e.data("state",!0);var n=r.find(".category-2-list li").length;return $.post({url:"/admin/product-category/add-category-2",data:{index:n,name:$.trim(a.val())?$.trim(a.val()):"无标题",category1Id:o}}).done(function(a){$.AMUI.progress.done(),e.data("state",!1),t.modal("close"),r.find(".category-2-list").append('\n                        <li data-id="'+a.id+'">\n                            <strong>'+a.name+'</strong>\n                            <span class="options">\n                                <a class="edit-category-2" href="javascript:;">编辑</a>\n                                <a class="moveup-category-2" href="javascript:;">上移</a>\n                                <a class="movedown-category-2" href="javascript:;">下移</a>\n                                <a class="remove-category-2" href="javascript:;">删除</a>\n                            </span>\n                        </li>\n                ')}),!1})},editCategory2:function(){var t=$("#modal-category-2-edit"),a=$("#input-category-2-edit"),e=$("#modal-category-2-confirm-edit"),o=$("#modal-alert"),n=null,i=null;this.container.on("click",".edit-category-2",function(){return n=$(this).parents("li"),a.val($.trim(n.find("strong").text())),i=n.attr("data-id"),t.modal({relatedTarget:this}),!1}),e.click(function(){return e.data("state")?!1:($.AMUI.progress.start(),e.data("state",!0),$.get({url:leanApp.api+"classes/ProductCategory2",headers:r,data:'where={"category2Id":'+i+"}"}).done(function(t){return $.ajax({type:"PUT",url:leanApp.api+"classes/ProductCategory2/"+t.results[0].objectId,headers:r,data:JSON.stringify({name:$.trim(a.val())})})}).done(function(){e.data("state",!1),$.AMUI.progress.done(),t.modal("close"),o.modal({onConfirm:function(){return n.find("strong").text(a.val())}}).find(".am-modal-bd").text("编辑二级分类成功!")}),!1)})},removeCategory2:function(){var t=$("#modal-category-2-remove"),a=$("#modal-alert"),e=null;this.container.on("click",".remove-category-2",function(){var r=$(this);return e=r.parents("li"),t.modal({relatedTarget:this,onConfirm:function(){return r.data("state")?!1:(r.data("state",!0),$.AMUI.progress.start(),$.get({url:"/admin/product-category/remove-category-2",data:{category1Id:e.parents(".am-accordion-item").attr("data-id"),category2Id:e.attr("data-id")},success:function(){r.data("state",!1),$.AMUI.progress.done(),t.modal("close"),a.modal({onConfirm:function(){return e.detach()}}).find(".am-modal-bd").text("删除二级分类成功!")}}),!1)}}),!1})},moveCategory2Up:function(){this.container.on("click",".moveup-category-2",function(){var t=$(this),a=$(this).parents("li"),e=a.attr("data-id"),r=a.prev(),o=r.attr("data-id"),n=a.index();return 0===n?!1:t.data("state")?!1:(t.data("state",!0),$.AMUI.progress.start(),$.get({url:"/admin/product-category/move-category-2-up",data:{currentId:e,targetId:o}}).done(function(e){e.success&&(a.after(r),t.data("state",!1),$.AMUI.progress.done())}),!1)})},moveCategory2Down:function(){this.container.on("click",".movedown-category-2",function(){var t=$(this),a=$(this).parents("li"),e=a.attr("data-id"),r=a.next(),o=r.attr("data-id"),n=a.index();return n===a.parent().find("li").length-1?!1:t.data("state")?!1:(t.data("state",!0),$.AMUI.progress.start(),$.get({url:"/admin/product-category/move-category-2-down",data:{currentId:e,targetId:o}}).done(function(e){e.success&&(a.before(r),t.data("state",!1),$.AMUI.progress.done())}),!1)})}}},{}],product:[function(t,a,e){"use strict";var r=window.leanAppHeader;a.exports={indexFun:function(){var t=$(".select-category-1"),a=$(".select-category-2"),e=$("#modal-alert");t.change(function(){return this.value>0?location.href="/admin/product?category1Id="+this.value:void(location.href="/admin/product")}),a.change(function(){var a=t.val();return this.value>0?location.href="/admin/product?category1Id="+a+"&category2Id="+this.value:void(location.href="/admin/product?category1Id="+a)}),$(".remove-product").click(function(){var t=$(this);return $("#confirm-remove-product").modal({relatedTarget:this,onConfirm:function(){var a=t.attr("data-id");$.get({url:leanApp.api+"classes/Product",headers:r,data:'where={"productId":'+a+"}"}).done(function(t){return $.get({type:"delete",url:leanApp.api+"classes/Product/"+t.results[0].objectId,headers:r})}).done(function(){e.modal({onConfirm:function(){return t.parents("tr").detach()}}).find(".am-modal-bd").text("删除产品成功!")})},onCancel:function(){return!1}}),!1})},addFun:function(){this.setCategory(),this.chooseBanner(),this.setMainImage(),this.submitControl()},editFun:function(){this.setCategory(),this.chooseBanner(),this.setMainImage(),this.submitControl()},setCategory:function(){var t=$("#select-category-1"),a=$("#select-category-2"),e=$("#submit");t.change(function(){if(e.data("state"))return!1;var t=this.value;return a.find("option").detach(),$.get({url:leanApp.api+"classes/ProductCategory2",headers:r,data:'where={"category1Id":'+t+"}"}).done(function(t){var e="";$.each(t.results,function(t,a){e+='<option value="'+a.category2Id+'">'+a.name+"</option>"}),a.append(e)}),!1}),a.change(function(){return!1})},chooseBanner:function(){var t=$("#select-banner"),a=$(".banner-view");t.on("change",function(){return this.value?(a.removeClass("hide"),void a.html('<img width="400" src="'+t.find("option:selected").attr("data-src")+'"/>')):(a.addClass("hide"),!1)})},setMainImage:function(){var t=$("#main-image"),a=$(".main-image-list");t.change(function(){a.empty();var e=t.val().split("\n");""!==$.trim(e[0])&&$.each(e,function(t){a.append('<li><a href="'+e[t]+'" target="_blank"><img src="'+e[t]+'"/></a></li>')})})},submitControl:function(){var t=$("#submit");$(".am-form").validator({submit:function(){return this.isFormValid()?void t.attr("disabled",!0).addClass("am-disabled"):!1}})}}},{}]},{},[4]);