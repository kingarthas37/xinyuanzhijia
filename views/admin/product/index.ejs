<!DOCTYPE html>
<html>
<head>
    <% include ../partials/meta %>
    <title><%= title %></title>
    <% include ../partials/css %>
</head>
<body>

<% include ../partials/header %>

<% if (flash.success != '') { %>
<div class="am-alert am-alert-success">
    <p><%= flash.success %></p>
</div>
<% } %>

<div class="am-cf admin-main">

    <!-- sidebar start -->
    <% include ../partials/sidebar %>
    <!-- sidebar end -->

    <!-- content start -->
    <div class="admin-content admin-product-page">

        <div class="am-cf am-padding">
            <div class="am-fl am-cf"><strong><a href="/admin/product">产品编辑</a></strong> / <a href="/admin/product">所有产品列表</a>
            </div>
        </div>

        <div class="am-g">
            <form class="am-form" action="/admin/product" method="get">
                
                <div class="am-u-sm-12 am-u-md-3">
                    <div class="am-form-group">
                        <div class="am-input-group am-input-group-sm">
                            <input type="text" name="search" value="<%=search%>" class="search am-form-field" placeholder="搜索产品">
                            <span class="am-input-group-btn"><button class="am-btn am-btn-primary" type="submit">搜索</button></span>
                        </div>
                    </div>
                </div>

                <div class="am-u-sm-12 am-u-md-3">
                    <div class="am-form-group">
                        <select class="select-product-method">
                            <option value="">产品类型</option>
                            <% for (var i=0;i < productMethod.length; i++) { %>
                            <option
                            <% if(productMethod[i].get('productMethodId') === productMethodId ) { %> selected="selected" <% } %>
                            value="<%= productMethod[i].get('productMethodId'); %>"> <%= productMethod[i].get('name');%></option><%
                            } %>
                        </select>
                    </div>
                </div>

                <div class="am-u-sm-12 am-u-md-3">
                    <div class="am-form-group">
                        <select class="select-category-1">
                            <option value="">商品一级分类</option>
                            <% for (var i=0;i < category1.length; i++) { %>
                            <option <% if(category1[i].get('category1Id') === category1Id ) { %> selected="selected" <% } %>value="<%= category1[i].get('category1Id') %>"> <%= category1[i].get('name');%></option><% }%>
                        </select>
                    </div>
                </div>
                
                <div class="am-u-sm-12 am-u-md-3">
                    <div class="am-form-group">
                        <select class="select-category-2">
                            <option value="">商品二级分类</option>
                            <% for (var i=0;i < category2.length; i++) { %>
                            <option
                            <% if(category2[i].get('category2Id') === category2Id ) { %> selected="selected" <% } %>
                            value="<%= category2[i].get('category2Id') %>"> <%= category2[i].get('name');%></option><% }
                            %>
                        </select>
                    </div>
                </div>
            </form>
        </div>


        <div class="am-g">
            <div class="am-u-sm-12">
                <table class="am-table am-table-striped">
                    <thead>
                    <tr>
                        <th>产品名称</th>
                        <th class="t-c">链接</th>
                        <th class="t-c">复制</th>
                        <th class="t-c small-screen-hide">更新时间</th>
                        <th class="t-c small-screen-hide">删除</th>
                    </tr>
                    </thead>
                    <tbody>
                    <% for(var i=0; i < product.length; i++) {%>
                    <tr data-product-id="<%= product[i].get('productId') %>">
                        <td><a target="_blank" href="<%= product[i].mainImage%>"><%if(product[i].mainImage) {%><img width="32" src="<%= product[i].mainImage%>?imageMogr2/thumbnail/32" alt=""></a><%}else{%><img src="http://ac-QuiPuWpJ.clouddn.com/0d56f9d95dc6da7edf45.png?imageMogr2/thumbnail/32" width="32"/><%}%> <a href="/admin/product/edit/<%= product[i].get('productId') %>"><%= product[i].get('name')%></a>
                            <% for(var j=0;j<product[i].get('productMethod').length;j++) { %><a href="/admin/product?product-method-id=<%=product[i].get('productMethod')[j]%>&category1-id=<%=product[i].get('category1')[j]%>&category2-id=<%=product[i].get('category2')[j]%>"><i class="am-icon-tag"></i></a> <%}%>
                        </td>
                        <td class="t-c">
                            <span class="purchase-link" data-product-id="<%= product[i].get('productId') %>"><em class="loading-elem on"></em></span>
                            <span class="split"></span>
                            <a href="/admin/product-property/<%= product[i].get('productId') %>#purchase-link"><i class="am-icon-edit"></i></a>
                        </td>
                        <td class="t-c"><a href="/admin/product/copy/<%= product[i].get('productId') %>"><i class="am-icon-copy"></i></a></td>
                        <td class="t-c small-screen-hide"><%= product[i].updatedDate %></td>
                        <td class="t-c small-screen-hide"><a href="javascript:;" data-id="<%= product[i].get('productId') %>" class="remove-product"><i class="am-icon-remove"></i></a></td>
                    </tr>
                    <% } %>
                    </tbody>
                </table>

                <div class="am-pager am-cf">
                    <div class="am-fl">
                        <ul class="am-pagination">
                            <%- pagerHtml %>
                        </ul>
                    </div>
                    <div class="am-fr">
                        第<%=pager.page%>页 共<%=pager.count%>条
                    </div>
                </div>

                <div class="am-form-group">
                    <a href="/admin/product/add" class="am-btn am-btn-primary" role="button">添加新产品</a>
                </div>

            </div>
        </div>

    </div>
    <!-- content end -->

</div>


<!-- modal 删除产品 -->
<div class="am-modal am-modal-confirm" tabindex="-1" id="confirm-remove-product">
    <div class="am-modal-dialog">
        <div class="am-modal-bd">
            确定要删除这条记录吗？
        </div>
        <div class="am-modal-footer">
            <span class="am-modal-btn" data-am-modal-confirm>确定</span>
            <span class="am-modal-btn" data-am-modal-cancel>取消</span>
        </div>
    </div>
</div>
<!-- modal 删除产品 -->


<!-- modal alert -->
<div class="am-modal am-modal-confirm" tabindex="-1" id="modal-alert">
    <div class="am-modal-dialog">
        <div class="am-modal-hd">提示</div>
        <div class="am-modal-bd"></div>
        <div class="am-modal-footer">
            <span class="am-modal-btn" data-am-modal-confirm>确认</span>
        </div>
    </div>
</div>
<!-- modal alert -->


<% include ../partials/footer %>
<% include ../partials/js %>

<script type="text/javascript">
    $(function () {
        var product = require('product');
        product.indexFun();
    });
</script>
</body>
</html>